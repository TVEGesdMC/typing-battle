<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Battle - Infinite Levels!</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="game-container">
        <div class="header">
            <div class="user-info">
                <h2><span id="player-title"></span><span id="username"></span>!</h2>
                <div class="stats">
                    ğŸ’ Gems: <span id="gems-count">0</span> |
                    Best Level: <span id="best-level">0</span> |
                    Games Played: <span id="games-played">0</span>
                </div>
            </div>
            <div class="nav-links">
                <a href="leaderboard.html">ğŸ† Leaderboard</a>
                <a href="#" onclick="toggleShop()" class="btn">ğŸ›’ Shop</a>
                <a href="#" onclick="togglePremium()" class="btn">ğŸ’ Premium</a>
                <a href="#" onclick="toggleAdmin()" class="btn admin-btn" id="admin-btn" style="display: none;">âš¡ Admin Panel</a>
                <a href="#" onclick="logout()" class="btn">Logout</a>
            </div>
        </div>

        <h1>Typing Battle!</h1>
        
        <!-- Global Announcements -->
        <div id="global-announcements" class="global-announcements" style="display: none;">
            <div class="announcement-content">
                <div class="announcement-header">
                    <span class="announcement-tag">ğŸ“¢ GLOBAL ANNOUNCEMENT</span>
                    <span class="announcement-close" onclick="closeAnnouncement()">&times;</span>
                </div>
                <div class="announcement-message" id="announcement-text"></div>
                <div class="announcement-author" id="announcement-author"></div>
            </div>
        </div>
        
        <!-- Global Events -->
        <div id="global-event-banner" class="global-event-banner" style="display: none;">
            <div class="event-content">
                <span class="event-icon">ğŸ¯</span>
                <span class="event-text" id="event-text"></span>
                <span class="event-multiplier" id="event-multiplier"></span>
            </div>
        </div>
        
        <p id="level-info">Level: <span id="current-level">1</span></p>
        <div id="monster-area">
            <div class="character">
                <h2 id="monster-name">Monster</h2>
                <p>Health: <span id="monster-health">100</span></p>
            </div>
        </div>
        <div id="player-area">
            <div class="character">
                <h2>Player</h2>
                <p>Health: <span id="player-health">100</span></p>
            </div>
        </div>

        <p id="current-word"></p>
        <div id="cheat-indicator" style="display: none;">ğŸš€ CHEAT MODE ACTIVE ğŸš€</div>
        <input type="text" id="typing-input" placeholder="Type the word...">
        <p id="message" class="message"></p>

        <div style="margin-top: 20px;">
            <button class="btn" onclick="startGame()">New Game</button>
        </div>
    </div>

    <!-- Shop Interface -->
    <div id="shop-overlay" class="shop-overlay" style="display: none;">
        <div class="shop-container">
            <div class="shop-header">
                <h2>âš”ï¸ Warrior's Shop âš”ï¸</h2>
                <span class="close-shop" onclick="toggleShop()">&times;</span>
            </div>
            
            <div class="gems-display">
                ğŸ’ Your Gems: <span id="shop-gems">0</span>
            </div>

            <div class="shop-tabs">
                <button class="tab-btn active" onclick="showTab('titles')">ğŸ… Titles</button>
                <button class="tab-btn" onclick="showTab('perks')">âš¡ Perks</button>
            </div>

            <div id="titles-tab" class="shop-tab active">
                <h3>ğŸ… Titles (Permanent)</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-secondary" onclick="unequipTitle()">âŒ Remove Current Title</button>
                </div>
                <div class="shop-items">
                    <!-- Regular Titles -->
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ—¡ï¸ Sword Master</h4>
                            <p>Show your mastery with blades</p>
                        </div>
                        <div class="item-price">
                            <span class="price">500 ğŸ’</span>
                            <button onclick="buyItem('title', 'swordmaster', 500)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ† Champion</h4>
                            <p>For true heroes of the arena</p>
                        </div>
                        <div class="item-price">
                            <span class="price">1000 ğŸ’</span>
                            <button onclick="buyItem('title', 'champion', 1000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ‘‘ Legendary</h4>
                            <p>Reserved for legends only</p>
                        </div>
                        <div class="item-price">
                            <span class="price">2500 ğŸ’</span>
                            <button onclick="buyItem('title', 'legendary', 2500)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ”¥ Pyromaniac</h4>
                            <p>Burns through enemies like fire</p>
                        </div>
                        <div class="item-price">
                            <span class="price">1500 ğŸ’</span>
                            <button onclick="buyItem('title', 'pyromaniac', 1500)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>âš¡ Lightning Fingers</h4>
                            <p>Types faster than lightning strikes</p>
                        </div>
                        <div class="item-price">
                            <span class="price">2000 ğŸ’</span>
                            <button onclick="buyItem('title', 'lightning', 2000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸŒŸ Starborn</h4>
                            <p>Born from the stars themselves</p>
                        </div>
                        <div class="item-price">
                            <span class="price">3000 ğŸ’</span>
                            <button onclick="buyItem('title', 'starborn', 3000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    
                    <!-- Premium Only Titles -->
                    <div class="shop-section-divider" style="margin: 20px 0; padding: 10px; background: linear-gradient(45deg, #fdcb6e, #e17055); border-radius: 10px; color: white; text-align: center; font-weight: bold;">
                        âœ¨ PREMIUM EXCLUSIVE TITLES âœ¨
                    </div>
                    <div class="shop-item premium-only">
                        <div class="item-info">
                            <h4>ğŸŒˆ Reality Bender</h4>
                            <p>Bends the laws of typing reality (Premium Only)</p>
                        </div>
                        <div class="item-price">
                            <span class="price">5000 ğŸ’</span>
                            <button onclick="buyItem('title', 'realitybender', 5000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item premium-only">
                        <div class="item-info">
                            <h4>ğŸ’€ Death's Typist</h4>
                            <p>Even Death fears your typing speed (Premium Only)</p>
                        </div>
                        <div class="item-price">
                            <span class="price">6000 ğŸ’</span>
                            <button onclick="buyItem('title', 'deathstypist', 6000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item premium-only">
                        <div class="item-info">
                            <h4>ğŸš€ Quantum Warrior</h4>
                            <p>Exists in multiple typing dimensions (Premium Only)</p>
                        </div>
                        <div class="item-price">
                            <span class="price">7500 ğŸ’</span>
                            <button onclick="buyItem('title', 'quantum', 7500)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item premium-only">
                        <div class="item-info">
                            <h4>ğŸŒŒ Universe Destroyer</h4>
                            <p>Your typing destroys entire universes (Premium Only)</p>
                        </div>
                        <div class="item-price">
                            <span class="price">10000 ğŸ’</span>
                            <button onclick="buyItem('title', 'universedestroyer', 10000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item premium-only">
                        <div class="item-info">
                            <h4>ğŸ‘ï¸ The All-Seeing Typer</h4>
                            <p>Sees all words before they appear (Premium Only)</p>
                        </div>
                        <div class="item-price">
                            <span class="price">12000 ğŸ’</span>
                            <button onclick="buyItem('title', 'allseeing', 12000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item premium-only">
                        <div class="item-info">
                            <h4>ğŸ”® Mystic Wordweaver</h4>
                            <p>Weaves words from pure magic (Premium Only)</p>
                        </div>
                        <div class="item-price">
                            <span class="price">8000 ğŸ’</span>
                            <button onclick="buyItem('title', 'wordweaver', 8000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item premium-only">
                        <div class="item-info">
                            <h4>âš¡ Godslayer Typist</h4>
                            <p>Even gods fear your keyboard (Premium Only)</p>
                        </div>
                        <div class="item-price">
                            <span class="price">15000 ğŸ’</span>
                            <button onclick="buyItem('title', 'godslayer', 15000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="perks-tab" class="shop-tab">
                <h3>âš¡ Combat Perks (Permanent)</h3>
                <div class="shop-items">
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ’ª Double Damage</h4>
                            <p>Deal 2x damage to monsters</p>
                        </div>
                        <div class="item-price">
                            <span class="price">800 ğŸ’</span>
                            <button onclick="buyItem('perk', 'doubleDamage', 800)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>â¤ï¸ Extra Health</h4>
                            <p>Start with 150 health instead of 100</p>
                        </div>
                        <div class="item-price">
                            <span class="price">600 ğŸ’</span>
                            <button onclick="buyItem('perk', 'extraHealth', 600)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>âš¡ Fast Typing</h4>
                            <p>Monsters take longer to attack</p>
                        </div>
                        <div class="item-price">
                            <span class="price">700 ğŸ’</span>
                            <button onclick="buyItem('perk', 'fastTyping', 700)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ’ Gem Collector</h4>
                            <p>Earn 50% more gems per level</p>
                        </div>
                        <div class="item-price">
                            <span class="price">1200 ğŸ’</span>
                            <button onclick="buyItem('perk', 'gemBonus', 1200)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Premium Interface -->
    <div id="premium-overlay" class="shop-overlay" style="display: none;">
        <div class="shop-container">
            <div class="shop-header">
                <h2>ğŸ’ Premium Membership</h2>
                <span class="close-shop" onclick="togglePremium()">&times;</span>
            </div>
            
            <div id="premium-content">
                <!-- This will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Admin Panel Interface -->
    <div id="admin-overlay" class="shop-overlay" style="display: none;">
        <div class="admin-container">
            <div class="shop-header">
                <h2>âš¡ Admin Control Panel</h2>
                <span class="close-shop" onclick="toggleAdmin()">&times;</span>
            </div>
            
            <div class="admin-content">
                <div class="admin-section">
                    <h3>ğŸ“¢ Global Announcements</h3>
                    <textarea id="announcement-input" class="admin-textarea" placeholder="Enter your global announcement..." maxlength="200"></textarea>
                    <button class="btn admin-action-btn" onclick="sendGlobalAnnouncement()">ğŸ“¢ Send Announcement</button>
                </div>
                
                <div class="admin-section">
                    <h3>ğŸ¯ Global Events</h3>
                    <div class="event-controls">
                        <select id="event-type" class="admin-select">
                            <option value="double-gems">ğŸ’ Double Gems Event</option>
                            <option value="triple-gems">ğŸ’ Triple Gems Event</option>
                            <option value="speed-boost">âš¡ Speed Boost Event</option>
                            <option value="mega-damage">ğŸ’ª Mega Damage Event</option>
                            <option value="boss-rush">ğŸ‘¹ Boss Rush Event</option>
                        </select>
                        <input type="number" id="event-duration" class="admin-input" placeholder="Duration (minutes)" min="1" max="60" value="10">
                        <button class="btn admin-action-btn" onclick="startGlobalEvent()">ğŸ¯ Start Event</button>
                        <button class="btn btn-secondary" onclick="endGlobalEvent()">ğŸ›‘ End Current Event</button>
                    </div>
                </div>
                
                <div class="admin-section">
                    <h3>ğŸ¬ YouTuber Titles Management</h3>
                    <div class="youtuber-controls">
                        <input type="text" id="custom-youtuber-title" class="admin-input" placeholder="Create custom YouTuber title..." maxlength="25">
                        <button class="btn admin-action-btn" onclick="createYoutuberTitle()">ğŸ¬ Create Title</button>
                    </div>
                    <div class="youtuber-assign">
                        <select id="youtuber-title-select" class="admin-select">
                            <option value="">Select YouTuber Title</option>
                        </select>
                        <input type="text" id="assign-username" class="admin-input" placeholder="Username to assign title to...">
                        <button class="btn admin-action-btn" onclick="assignYoutuberTitle()">ğŸ‘‘ Assign Title</button>
                    </div>
                    <div id="youtuber-titles-list" class="admin-list"></div>
                </div>
                
                <div class="admin-section">
                    <h3>ğŸš« User Management</h3>
                    <div class="user-controls">
                        <input type="text" id="target-username" class="admin-input" placeholder="Target username...">
                        <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                            <button class="btn" style="background: linear-gradient(45deg, #e74c3c, #c0392b);" onclick="banUser()">ğŸš« Ban User</button>
                            <button class="btn" style="background: linear-gradient(45deg, #f39c12, #e67e22);" onclick="unbanUser()">âœ… Unban User</button>
                            <button class="btn" style="background: linear-gradient(45deg, #8e44ad, #9b59b6);" onclick="resetUserProgress()">ğŸ”„ Reset Progress</button>
                            <button class="btn" style="background: linear-gradient(45deg, #2c3e50, #34495e);" onclick="terminateAccount()">ğŸ’€ Terminate Account</button>
                        </div>
                    </div>
                    <div class="user-actions" style="margin-top: 15px;">
                        <button class="btn btn-secondary" onclick="viewUserDetails()">ğŸ‘¤ View User Details</button>
                        <button class="btn btn-secondary" onclick="giveGems()">ğŸ’ Give Gems</button>
                        <button class="btn btn-secondary" onclick="takeGems()">ğŸ’¸ Take Gems</button>
                        <button class="btn btn-secondary" onclick="grantPremium()">â­ Grant Premium</button>
                    </div>
                </div>
                
                <div class="admin-section">
                    <h3>ğŸ“Š Server Statistics</h3>
                    <div class="admin-status">
                        <p><strong>Total Users:</strong> <span id="total-users">-</span></p>
                        <p><strong>Active Users:</strong> <span id="active-users">-</span></p>
                        <p><strong>Banned Users:</strong> <span id="banned-users">-</span></p>
                        <p><strong>Premium Users:</strong> <span id="premium-users">-</span></p>
                        <button class="btn btn-secondary" onclick="refreshStats()">ğŸ”„ Refresh Stats</button>
                    </div>
                </div>
                
                <div class="admin-section">
                    <h3>ğŸ“Š Current Status</h3>
                    <div class="admin-status">
                        <p><strong>Active Event:</strong> <span id="current-event-status">None</span></p>
                        <p><strong>Time Remaining:</strong> <span id="event-time-remaining">-</span></p>
                        <p><strong>Last Announcement:</strong> <span id="last-announcement">None</span></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const words = ["attack", "defend", "magic", "sword", "shield", "spell", "heal", "potion", "strike", "dodge", "ability", "spirit", "valor", "courage", "fury", "enchant", "bless", "curse", "poison", "fire", "ice", "thunder", "earth", "wind", "light", "darkness", "focus", "meditate", "charge", "parry", "slap", "tackle"];
        const bossWords = ["destroyer", "annihilator", "overlord", "tyrant", "colossus", "behemoth", "leviathan", "abomination", "conqueror", "devastator", "ram", "tackle", "shoot", "arrow", "sword", "chargoggagoggmanchauggagoggchaubunagungamaugg", "dragon", "wyvern", "hydra", "golem", "beast", "fiend", "demon", "devil", "angel", "archangel", "archfiend", "archdemon", "Erythrocytapheresis", "Supercalifragilisticexpialidocious"];

        let currentWord = "";
        let monsterHealth = 100;
        let playerHealth = 100;
        let currentLevel = 1;
        let isBossFight = false;
        let currentUser = "";
        let cheatMode = false;
        let cheatInterval = null;
        let gems = 0;
        let shopVisible = false;
        let playerTitle = "";
        let isPremium = false;
        let customTitle = "";
        let playerPerks = {
            doubleDamage: false,
            extraHealth: false,
            fastTyping: false,
            gemBonus: false
        };
        
        // Global events and admin system
        let globalEvent = null;
        let eventEndTime = null;
        let eventCheckInterval = null;

        const monsterHealthSpan = document.getElementById("monster-health");
        const playerHealthSpan = document.getElementById("player-health");
        const currentWordDisplay = document.getElementById("current-word");
        const typingInput = document.getElementById("typing-input");
        const messageDisplay = document.getElementById("message");
        const currentLevelDisplay = document.getElementById("current-level");
        const monsterNameDisplay = document.getElementById("monster-name");
        const cheatIndicator = document.getElementById("cheat-indicator");

        function checkAuth() {
            currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'signup.html';
                return false;
            }

            // Check if user is banned
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (users[currentUser] && users[currentUser].banned) {
                alert('ğŸš« Your account has been banned. Contact an administrator for more information.');
                localStorage.removeItem('currentUser');
                window.location.href = 'signup.html';
                return false;
            }

            document.getElementById('username').textContent = currentUser;
            loadUserStats();
            
            // Show admin panel for special user
            if (currentUser === 'TVEGesdreal') {
                document.getElementById('admin-btn').style.display = 'inline-block';
            }
            
            // Check for active global events
            checkGlobalEvents();
            
            return true;
        }

        function loadUserStats() {
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            const userData = users[currentUser] || {maxLevel: 0, gamesPlayed: 0, gems: 0, title: '', perks: {}, isPremium: false, customTitle: '', ownedTitles: []};

            gems = userData.gems || 0;
            playerTitle = userData.title || '';
            isPremium = userData.isPremium || false;
            
            // Auto-activate premium for special username
            if (currentUser === 'TVEGesdreal' && !isPremium) {
                isPremium = true;
                userData.isPremium = true;
                users[currentUser] = userData;
                localStorage.setItem('typingBattleUsers', JSON.stringify(users));
            }
            customTitle = userData.customTitle || '';
            playerPerks = userData.perks || {doubleDamage: false, extraHealth: false, fastTyping: false, gemBonus: false};
            
            // Ensure ownedTitles exists and includes current title
            if (!userData.ownedTitles) {
                userData.ownedTitles = [];
                if (playerTitle && !userData.ownedTitles.includes(playerTitle)) {
                    userData.ownedTitles.push(playerTitle);
                    users[currentUser] = userData;
                    localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                }
            }

            document.getElementById('best-level').textContent = userData.maxLevel;
            document.getElementById('games-played').textContent = userData.gamesPlayed;
            document.getElementById('gems-count').textContent = gems;
            document.getElementById('shop-gems').textContent = gems;
            
            // Update title display - check YouTuber titles first
            const titleElement = document.getElementById('player-title');
            const youtuberTitles = JSON.parse(localStorage.getItem('youtuberTitles') || '{}');
            const userYoutuberTitles = userData.youtuberTitles || [];
            
            if (userYoutuberTitles.length > 0 && youtuberTitles[userYoutuberTitles[0]]) {
                // Show first YouTuber title (highest priority)
                const youtuberTitle = youtuberTitles[userYoutuberTitles[0]];
                titleElement.innerHTML = `ğŸ¬ ${youtuberTitle.name} `;
                titleElement.style.color = '#ff4757';
                titleElement.style.textShadow = '2px 2px 4px rgba(0,0,0,0.3)';
            } else if (isPremium && customTitle) {
                titleElement.innerHTML = `âœ¨ ${customTitle} `;
                titleElement.style.color = '#e17055';
                titleElement.style.textShadow = '1px 1px 2px rgba(0,0,0,0.3)';
            } else if (playerTitle) {
                const titleText = getTitleText(playerTitle);
                titleElement.textContent = titleText + ' ';
                titleElement.style.color = getTitleColor(playerTitle);
                titleElement.style.textShadow = '1px 1px 2px rgba(0,0,0,0.2)';
            } else {
                titleElement.textContent = 'Welcome, ';
                titleElement.style.color = '#333';
                titleElement.style.textShadow = 'none';
            }
            
            updateShopButtons();
        }

        function updateUserStats(level) {
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (users[currentUser]) {
                users[currentUser].maxLevel = Math.max(users[currentUser].maxLevel || 0, level);
                users[currentUser].gamesPlayed = (users[currentUser].gamesPlayed || 0) + 1;
                users[currentUser].gems = gems;
                users[currentUser].title = playerTitle;
                users[currentUser].perks = playerPerks;
                users[currentUser].isPremium = isPremium;
                users[currentUser].customTitle = customTitle;
                localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                loadUserStats();
            }
        }

        function saveUserData() {
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (users[currentUser]) {
                users[currentUser].gems = gems;
                users[currentUser].title = playerTitle;
                users[currentUser].perks = playerPerks;
                users[currentUser].isPremium = isPremium;
                users[currentUser].customTitle = customTitle;
                localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                loadUserStats();
            }
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'signup.html';
        }

        function toggleCheatMode() {
            cheatMode = !cheatMode;
            cheatIndicator.style.display = cheatMode ? 'block' : 'none';

            if (cheatMode) {
                cheatIndicator.style.color = '#ff6b6b';
                cheatIndicator.style.fontSize = '1.2em';
                cheatIndicator.style.fontWeight = 'bold';
                cheatIndicator.style.animation = 'textGlow 1s ease-in-out infinite alternate';
                cheatIndicator.style.marginTop = '10px';
                
                // Immediately start typing the current word if game is active
                if (currentWord && !typingInput.disabled) {
                    setTimeout(autoType, 100);
                }
            } else {
                if (cheatInterval) {
                    clearInterval(cheatInterval);
                    cheatInterval = null;
                }
            }
        }

        function autoType() {
            if (!cheatMode || typingInput.disabled || !currentWord) return;

            // Clear any existing interval
            if (cheatInterval) {
                clearInterval(cheatInterval);
            }

            const word = currentWord;
            let index = 0;
            typingInput.value = ""; // Clear input before starting

            cheatInterval = setInterval(() => {
                if (!cheatMode || typingInput.disabled || index >= word.length) {
                    if (index >= word.length && cheatMode && !typingInput.disabled) {
                        // Simulate Enter key press after a short delay
                        setTimeout(() => {
                            if (cheatMode && !typingInput.disabled) {
                                const enterEvent = new KeyboardEvent('keyup', {key: 'Enter'});
                                typingInput.dispatchEvent(enterEvent);
                            }
                        }, 100);
                    }
                    clearInterval(cheatInterval);
                    cheatInterval = null;
                    return;
                }

                typingInput.value = word.substring(0, index + 1);
                index++;
            }, 30); // Faster typing - 30ms per character
        }

        function startGame() {
            playerHealth = playerPerks.extraHealth ? 150 : 100;
            currentLevel = 1;
            isBossFight = false;
            typingInput.disabled = false;
            monsterNameDisplay.classList.remove("boss");
            document.querySelector('#monster-area .character').classList.remove("boss");
            startLevel();
            updateHealthDisplays();
            typingInput.value = "";
            messageDisplay.textContent = "";
            typingInput.focus();
        }

        function startLevel() {
            currentLevelDisplay.textContent = currentLevel;
            const monsterDiv = document.querySelector('#monster-area .character');

            if (currentLevel % 5 === 0) {
                isBossFight = true;
                monsterHealth = 250;
                monsterNameDisplay.textContent = "BOSS MONSTER";
                monsterNameDisplay.classList.add("boss");
                monsterDiv.classList.add("boss");
            } else {
                isBossFight = false;
                monsterHealth = 100;
                monsterNameDisplay.textContent = "Monster";
                monsterNameDisplay.classList.remove("boss");
                monsterDiv.classList.remove("boss");
            }
            updateHealthDisplays();
            newWord();
        }

        function newWord() {
            let wordList = isBossFight ? bossWords : words;
            const randomIndex = Math.floor(Math.random() * wordList.length);
            currentWord = wordList[randomIndex];
            currentWordDisplay.textContent = currentWord;
            
            // If cheat mode is active, automatically start typing the new word
            if (cheatMode && !typingInput.disabled) {
                setTimeout(autoType, 200);
            }
        }

        function updateHealthDisplays() {
            monsterHealthSpan.textContent = monsterHealth;
            playerHealthSpan.textContent = playerHealth;
        }

        function attack(target) {
            let damage = Math.floor(Math.random() * 10) + 5;

            if (target === "monster") {
                if (isBossFight) {
                    damage = Math.floor(Math.random() * 20) + 15;
                }
                
                // Apply double damage perk
                if (playerPerks.doubleDamage) {
                    damage *= 2;
                }
                
                monsterHealth -= damage;
                if (monsterHealth <= 0) {
                    monsterHealth = 0;
                    
                    // Award gems for defeating monster
                    let gemsEarned = 100;
                    if (isBossFight) {
                        gemsEarned = 250; // Bonus for boss
                    }
                    if (playerPerks.gemBonus) {
                        gemsEarned = Math.floor(gemsEarned * 1.5);
                    }
                    if (isPremium) {
                        gemsEarned *= 2; // Premium double gems
                    }
                    
                    // Apply global event bonuses
                    if (globalEvent) {
                        if (globalEvent.type === 'double-gems') {
                            gemsEarned *= 2;
                        } else if (globalEvent.type === 'triple-gems') {
                            gemsEarned *= 3;
                        }
                    }
                    
                    gems += gemsEarned;
                    document.getElementById('gems-count').textContent = gems;
                    document.getElementById('shop-gems').textContent = gems;
                    
                    if (isBossFight) {
                        messageDisplay.textContent = `You defeated the BOSS! +${gemsEarned} gems!`;
                    } else {
                        messageDisplay.textContent = `You defeated the monster! +${gemsEarned} gems!`;
                    }
                    messageDisplay.classList.add("correct");
                    messageDisplay.classList.remove("incorrect");
                    levelUp();
                } else {
                    messageDisplay.textContent = `You dealt ${damage} damage to the ${monsterNameDisplay.textContent}!`;
                    messageDisplay.classList.add("correct");
                    messageDisplay.classList.remove("incorrect");
                }
            } else if (target === "player") {
                let monsterDamage = Math.floor(Math.random() * 12) + 8;

                if (isBossFight) {
                    monsterDamage = Math.floor(Math.random() * 25) + 20;
                }

                // Fast typing perk reduces monster damage
                if (playerPerks.fastTyping) {
                    monsterDamage = Math.floor(monsterDamage * 0.7);
                }

                playerHealth -= monsterDamage;
                if (playerHealth <= 0) {
                    playerHealth = 0;
                    endGame("The monster defeated you!");
                } else {
                    messageDisplay.textContent = `The ${monsterNameDisplay.textContent} dealt ${monsterDamage} damage to you!`;
                    messageDisplay.classList.add("incorrect");
                    messageDisplay.classList.remove("correct");
                }
            }
            updateHealthDisplays();
        }

        function levelUp() {
            currentLevel++;
            setTimeout(() => {
                startLevel();
            }, 1500);
        }

        function endGame(result) {
            currentWordDisplay.textContent = result;
            typingInput.disabled = true;
            messageDisplay.textContent = "Game Over! Click 'New Game' to play again.";
            messageDisplay.classList.add("game-over");
            updateUserStats(currentLevel - 1);
        }

        // Global keyboard listener for cheat activation
        document.addEventListener("keydown", (event) => {
            if (event.ctrlKey && event.altKey && event.key === 'c') {
                event.preventDefault();
                toggleCheatMode();
            }
        });

        typingInput.addEventListener("keyup", (event) => {
            if (typingInput.disabled) return;

            if (event.key === "Enter") {
                if (typingInput.value.toLowerCase() === currentWord) {
                    attack("monster");
                    if (monsterHealth > 0) {
                        newWord();
                    }
                } else {
                    messageDisplay.textContent = "Incorrect word! Monster attacks!";
                    messageDisplay.classList.add("incorrect");
                    messageDisplay.classList.remove("correct");
                    attack("player");
                    newWord();
                }
                typingInput.value = "";
            }
        });

        // Premium Functions
        function togglePremium() {
            const premiumVisible = document.getElementById('premium-overlay').style.display === 'flex';
            document.getElementById('premium-overlay').style.display = premiumVisible ? 'none' : 'flex';
            if (!premiumVisible) {
                updatePremiumContent();
            }
        }

        function updatePremiumContent() {
            const content = document.getElementById('premium-content');
            
            // Check for special username that gets free premium
            if (currentUser === 'TVEGesdreal' && !isPremium) {
                isPremium = true;
                saveUserData();
                alert('ğŸŒŸ Welcome VIP! Premium activated automatically for your account!');
            }
            
            if (isPremium) {
                content.innerHTML = `
                    <div class="premium-status">
                        âœ¨ Premium Active âœ¨
                    </div>
                    <div style="text-align: center; margin: 20px 0;">
                        <h3>Premium Benefits Active:</h3>
                        <p>ğŸ’ Double gems earned</p>
                        <p>âœ¨ Custom title available</p>
                        <p>ğŸ¯ Priority support</p>
                        <p>ğŸª Access to exclusive premium titles</p>
                    </div>
                    <div style="margin: 20px 0;">
                        <h4>Custom Title:</h4>
                        <input type="text" id="custom-title-input" class="custom-title-input" 
                               placeholder="Enter your custom title..." value="${customTitle}" maxlength="20">
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button class="btn" onclick="setCustomTitle()">Update Title</button>
                            <button class="btn btn-secondary" onclick="disableCustomTitle()">âŒ Disable Custom Title</button>
                        </div>
                    </div>
                    <div style="margin: 20px 0; padding-top: 20px; border-top: 2px solid #ddd;">
                        <h4 style="color: #e17055;">âš ï¸ Disable Premium</h4>
                        <p style="color: #636e72; font-size: 0.9em;">Warning: You'll need to pay again to reactivate</p>
                        <button class="btn" style="background: linear-gradient(45deg, #e17055, #d63031);" onclick="disablePremium()">
                            ğŸš« Disable Premium
                        </button>
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div class="premium-banner">
                        <h3>ğŸŒŸ Upgrade to Premium! ğŸŒŸ</h3>
                        <p>ğŸ’ <strong>Double gems</strong> from all battles</p>
                        <p>âœ¨ <strong>Custom titles</strong> for ultimate personalization</p>
                        <p>ğŸª <strong>Exclusive premium titles</strong> in the shop</p>
                        <p>ğŸ¯ <strong>Priority support</strong> and exclusive features</p>
                        <p><strong>One-time payment: $1.99</strong></p>
                        <a href="https://cash.app/$TVEGESD" target="_blank" class="premium-btn">
                            ğŸ’³ Buy Premium - $1.99
                        </a>
                        <div style="margin-top: 15px;">
                            <h4>Receipt Verification Required:</h4>
                            <p style="font-size: 0.9em; color: #636e72; margin-bottom: 10px;">
                                Upload your Cash App receipt showing $1.99 payment to $TVEGESD from today
                            </p>
                            <input type="url" id="receipt-link" placeholder="Paste your Cash App receipt link here..." class="custom-title-input" style="margin-bottom: 10px;">
                            <button class="btn btn-secondary" onclick="verifyReceipt()">
                                ğŸ“„ Verify Receipt & Activate Premium
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        function verifyReceipt() {
            const linkInput = document.getElementById('receipt-link');
            const receiptLink = linkInput.value.trim();
            
            if (!receiptLink) {
                alert('âš ï¸ Please paste your receipt link first!');
                return;
            }
            
            if (!receiptLink.startsWith('http')) {
                alert('âš ï¸ Please enter a valid link starting with http or https');
                return;
            }
            
            const today = new Date().toDateString();
            
            // Simulate receipt verification (in a real app, this would be server-side)
            const verificationPrompt = prompt(`Receipt Verification:
            
Please confirm the following details from your receipt link:
1. Amount paid: $1.99
2. Recipient: $TVEGESD
3. Date: ${today}

Type "VERIFIED" if all details match exactly:`);
            
            if (verificationPrompt === "VERIFIED") {
                isPremium = true;
                const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
                if (users[currentUser]) {
                    users[currentUser].premiumActivationDate = today;
                    localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                }
                saveUserData();
                updatePremiumContent();
                alert('ğŸŒŸ Premium activated! You now earn double gems, can set custom titles, and access exclusive premium titles in the shop!');
            } else {
                alert('âŒ Sorry, you did not pay for premium. Please ensure your receipt shows exactly $1.99 paid to $TVEGESD from today.');
            }
        }

        function disablePremium() {
            if (confirm('âš ï¸ Are you sure you want to disable Premium? You will lose all premium benefits and need to pay again to reactivate.')) {
                isPremium = false;
                customTitle = '';
                saveUserData();
                updatePremiumContent();
                alert('ğŸš« Premium has been disabled. You will need to purchase again to reactivate.');
            }
        }

        function setCustomTitle() {
            const titleInput = document.getElementById('custom-title-input');
            const newTitle = titleInput.value.trim();
            
            if (newTitle.length === 0) {
                alert('Please enter a title!');
                return;
            }
            
            if (newTitle.length > 20) {
                alert('Title must be 20 characters or less!');
                return;
            }
            
            customTitle = newTitle;
            saveUserData();
            alert('âœ¨ Custom title updated!');
        }

        function disableCustomTitle() {
            if (!customTitle) {
                alert('No custom title is currently active!');
                return;
            }
            
            if (confirm('âš ï¸ Are you sure you want to disable your custom title? You can create a new one anytime.')) {
                customTitle = '';
                const titleInput = document.getElementById('custom-title-input');
                if (titleInput) {
                    titleInput.value = '';
                }
                saveUserData();
                alert('âŒ Custom title disabled!');
            }
        }

        // Shop Functions
        function toggleShop() {
            shopVisible = !shopVisible;
            document.getElementById('shop-overlay').style.display = shopVisible ? 'flex' : 'none';
            if (shopVisible) {
                updateShopButtons();
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.shop-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
        }

        function buyItem(type, item, price) {
            if (gems < price) {
                alert('Not enough gems! ğŸ’');
                return;
            }

            // Get user's owned titles
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            const userData = users[currentUser] || {};
            const ownedTitles = userData.ownedTitles || [];

            // Check if trying to buy premium title without premium
            const premiumTitles = ['realitybender', 'deathstypist', 'quantum', 'universedestroyer', 'allseeing', 'wordweaver', 'godslayer'];
            if (type === 'title' && premiumTitles.includes(item) && !isPremium) {
                alert('ğŸŒŸ Premium membership required to purchase this title! Upgrade to Premium first.');
                return;
            }

            if (type === 'title') {
                if (ownedTitles.includes(item)) {
                    alert('You already own this title! ğŸ‘‘');
                    return;
                }
                ownedTitles.push(item);
                playerTitle = item; // Automatically equip new title
                gems -= price;
                
                // Update user data with owned titles
                users[currentUser].ownedTitles = ownedTitles;
                localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                
                alert('Title purchased and equipped! âœ¨');
            } else if (type === 'perk') {
                if (playerPerks[item]) {
                    alert('You already own this perk! âš¡');
                    return;
                }
                playerPerks[item] = true;
                gems -= price;
                alert('Perk purchased! Your power grows! ğŸ’ª');
            }

            saveUserData();
            updateShopButtons();
        }

        function equipTitle(titleItem) {
            playerTitle = titleItem;
            saveUserData();
            updateShopButtons();
            
            const titleText = getTitleText(titleItem);
            alert(`Title equipped: ${titleText} âœ¨`);
        }

        function unequipTitle() {
            if (!playerTitle) {
                alert('No title currently equipped!');
                return;
            }
            
            playerTitle = '';
            saveUserData();
            updateShopButtons();
            alert('Title removed! âŒ');
        }

        function updateShopButtons() {
            // Update gems display
            document.getElementById('gems-count').textContent = gems;
            document.getElementById('shop-gems').textContent = gems;

            // Get user's owned titles
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            const userData = users[currentUser] || {};
            const ownedTitles = userData.ownedTitles || [];

            const premiumTitles = ['realitybender', 'deathstypist', 'quantum', 'universedestroyer', 'allseeing', 'wordweaver', 'godslayer'];

            // Update buy buttons and premium-only items
            document.querySelectorAll('.buy-btn').forEach(btn => {
                const onclick = btn.getAttribute('onclick');
                const match = onclick.match(/buyItem\('(\w+)', '(\w+)', (\d+)\)/);
                if (match) {
                    const [, type, item, price] = match;
                    
                    if (type === 'title' && ownedTitles.includes(item)) {
                        if (playerTitle === item) {
                            btn.textContent = 'Equipped';
                            btn.disabled = true;
                            btn.style.opacity = '0.5';
                            btn.style.background = 'linear-gradient(45deg, #00b894, #00a085)';
                        } else {
                            btn.textContent = 'Equip';
                            btn.disabled = false;
                            btn.style.opacity = '1';
                            btn.style.background = 'linear-gradient(45deg, #74b9ff, #0984e3)';
                            btn.setAttribute('onclick', `equipTitle('${item}')`);
                        }
                    } else if (type === 'perk' && playerPerks[item]) {
                        btn.textContent = 'Owned';
                        btn.disabled = true;
                        btn.style.opacity = '0.5';
                    } else if (type === 'title' && premiumTitles.includes(item) && !isPremium) {
                        btn.textContent = 'Premium Required';
                        btn.disabled = true;
                        btn.style.opacity = '0.5';
                    } else if (gems < parseInt(price)) {
                        btn.disabled = true;
                        btn.style.opacity = '0.5';
                    } else {
                        btn.textContent = 'Buy';
                        btn.disabled = false;
                        btn.style.opacity = '1';
                        btn.style.background = 'linear-gradient(45deg, #00b894, #00a085)';
                    }
                }
            });

            // Style premium-only items
            document.querySelectorAll('.premium-only').forEach(item => {
                if (!isPremium) {
                    item.style.opacity = '0.6';
                    item.style.background = 'linear-gradient(145deg, #f8f9fa, #e9ecef)';
                    item.style.border = '2px dashed #dee2e6';
                } else {
                    item.style.opacity = '1';
                    item.style.background = 'linear-gradient(145deg, #fff5e6, #ffe0b3)';
                    item.style.border = '2px solid #fdcb6e';
                }
            });
        }

        function getTitleText(title) {
            const titles = {
                'swordmaster': 'ğŸ—¡ï¸ Sword Master',
                'champion': 'ğŸ† Champion',
                'legendary': 'ğŸ‘‘ Legendary',
                'pyromaniac': 'ğŸ”¥ Pyromaniac',
                'lightning': 'âš¡ Lightning Fingers',
                'starborn': 'ğŸŒŸ Starborn',
                'realitybender': 'ğŸŒˆ Reality Bender',
                'deathstypist': 'ğŸ’€ Death\'s Typist',
                'quantum': 'ğŸš€ Quantum Warrior',
                'universedestroyer': 'ğŸŒŒ Universe Destroyer',
                'allseeing': 'ğŸ‘ï¸ All-Seeing Typer',
                'wordweaver': 'ğŸ”® Mystic Wordweaver',
                'godslayer': 'âš¡ Godslayer Typist'
            };
            
            // Check for YouTuber titles
            const youtuberTitles = JSON.parse(localStorage.getItem('youtuberTitles') || '{}');
            if (youtuberTitles[title]) {
                return `ğŸ¬ ${youtuberTitles[title].name}`;
            }
            
            return titles[title] || '';
        }

        function getTitleColor(title) {
            const colors = {
                'swordmaster': '#74b9ff',
                'champion': '#fdcb6e',
                'legendary': '#e17055',
                'pyromaniac': '#ff6b6b',
                'lightning': '#f39c12',
                'starborn': '#9b59b6',
                'realitybender': '#e74c3c',
                'deathstypist': '#2c3e50',
                'quantum': '#3498db',
                'universedestroyer': '#8e44ad',
                'allseeing': '#d35400',
                'wordweaver': '#27ae60',
                'godslayer': '#c0392b'
            };
            return colors[title] || '#333';
        }

        // Admin Panel Functions
        function toggleAdmin() {
            if (currentUser !== 'TVEGesdreal') {
                alert('Access Denied! Admin privileges required.');
                return;
            }
            
            const adminVisible = document.getElementById('admin-overlay').style.display === 'flex';
            document.getElementById('admin-overlay').style.display = adminVisible ? 'none' : 'flex';
            if (!adminVisible) {
                updateAdminStatus();
                loadYoutuberTitles();
                refreshStats();
            }
        }

        // YouTuber Titles Functions
        function createYoutuberTitle() {
            const titleInput = document.getElementById('custom-youtuber-title');
            const title = titleInput.value.trim();
            
            if (!title) {
                alert('Please enter a title name!');
                return;
            }
            
            if (title.length > 25) {
                alert('Title must be 25 characters or less!');
                return;
            }
            
            const youtuberTitles = JSON.parse(localStorage.getItem('youtuberTitles') || '{}');
            const titleId = title.toLowerCase().replace(/[^a-z0-9]/g, '');
            
            if (youtuberTitles[titleId]) {
                alert('This YouTuber title already exists!');
                return;
            }
            
            youtuberTitles[titleId] = {
                name: title,
                createdBy: currentUser,
                createdAt: new Date().toISOString(),
                assignedTo: []
            };
            
            localStorage.setItem('youtuberTitles', JSON.stringify(youtuberTitles));
            titleInput.value = '';
            loadYoutuberTitles();
            alert(`ğŸ¬ YouTuber title "${title}" created successfully!`);
        }

        function loadYoutuberTitles() {
            const youtuberTitles = JSON.parse(localStorage.getItem('youtuberTitles') || '{}');
            const select = document.getElementById('youtuber-title-select');
            const listDiv = document.getElementById('youtuber-titles-list');
            
            // Clear and populate select
            select.innerHTML = '<option value="">Select YouTuber Title</option>';
            
            let listHTML = '<h4>Existing YouTuber Titles:</h4>';
            
            for (const [id, titleData] of Object.entries(youtuberTitles)) {
                select.innerHTML += `<option value="${id}">${titleData.name}</option>`;
                
                listHTML += `
                    <div class="admin-list-item">
                        <span><strong>ğŸ¬ ${titleData.name}</strong></span>
                        <span>Assigned to: ${titleData.assignedTo.length} user(s)</span>
                        <button class="btn btn-secondary btn-sm" onclick="deleteYoutuberTitle('${id}')">ğŸ—‘ï¸ Delete</button>
                    </div>
                `;
            }
            
            if (Object.keys(youtuberTitles).length === 0) {
                listHTML += '<p style="color: #636e72; font-style: italic;">No YouTuber titles created yet.</p>';
            }
            
            listDiv.innerHTML = listHTML;
        }

        function assignYoutuberTitle() {
            const titleSelect = document.getElementById('youtuber-title-select');
            const usernameInput = document.getElementById('assign-username');
            const titleId = titleSelect.value;
            const username = usernameInput.value.trim();
            
            if (!titleId) {
                alert('Please select a YouTuber title!');
                return;
            }
            
            if (!username) {
                alert('Please enter a username!');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (!users[username]) {
                alert('User not found!');
                return;
            }
            
            const youtuberTitles = JSON.parse(localStorage.getItem('youtuberTitles') || '{}');
            const titleData = youtuberTitles[titleId];
            
            if (!titleData) {
                alert('YouTuber title not found!');
                return;
            }
            
            // Assign title to user
            if (!users[username].youtuberTitles) {
                users[username].youtuberTitles = [];
            }
            
            if (!users[username].youtuberTitles.includes(titleId)) {
                users[username].youtuberTitles.push(titleId);
                titleData.assignedTo.push(username);
                
                localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                localStorage.setItem('youtuberTitles', JSON.stringify(youtuberTitles));
                
                // Auto-assign to TVEGesdreal as well
                if (!users['TVEGesdreal'].youtuberTitles) {
                    users['TVEGesdreal'].youtuberTitles = [];
                }
                if (!users['TVEGesdreal'].youtuberTitles.includes(titleId)) {
                    users['TVEGesdreal'].youtuberTitles.push(titleId);
                    if (!titleData.assignedTo.includes('TVEGesdreal')) {
                        titleData.assignedTo.push('TVEGesdreal');
                    }
                    localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                    localStorage.setItem('youtuberTitles', JSON.stringify(youtuberTitles));
                }
                
                usernameInput.value = '';
                loadYoutuberTitles();
                alert(`ğŸ¬ YouTuber title "${titleData.name}" assigned to ${username} and TVEGesdreal!`);
            } else {
                alert('User already has this YouTuber title!');
            }
        }

        function deleteYoutuberTitle(titleId) {
            if (!confirm('Are you sure you want to delete this YouTuber title? This will remove it from all users who have it.')) {
                return;
            }
            
            const youtuberTitles = JSON.parse(localStorage.getItem('youtuberTitles') || '{}');
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            
            // Remove title from all users
            for (const username in users) {
                if (users[username].youtuberTitles) {
                    users[username].youtuberTitles = users[username].youtuberTitles.filter(id => id !== titleId);
                }
            }
            
            delete youtuberTitles[titleId];
            
            localStorage.setItem('youtuberTitles', JSON.stringify(youtuberTitles));
            localStorage.setItem('typingBattleUsers', JSON.stringify(users));
            
            loadYoutuberTitles();
            alert('YouTuber title deleted successfully!');
        }

        // User Management Functions
        function banUser() {
            const targetInput = document.getElementById('target-username');
            const username = targetInput.value.trim();
            
            if (!username) {
                alert('Please enter a username!');
                return;
            }
            
            if (username === 'TVEGesdreal') {
                alert('Cannot ban the admin account!');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (!users[username]) {
                alert('User not found!');
                return;
            }
            
            users[username].banned = true;
            users[username].bannedBy = currentUser;
            users[username].bannedAt = new Date().toISOString();
            
            localStorage.setItem('typingBattleUsers', JSON.stringify(users));
            targetInput.value = '';
            
            alert(`ğŸš« User "${username}" has been banned!`);
            refreshStats();
        }

        function unbanUser() {
            const targetInput = document.getElementById('target-username');
            const username = targetInput.value.trim();
            
            if (!username) {
                alert('Please enter a username!');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (!users[username]) {
                alert('User not found!');
                return;
            }
            
            delete users[username].banned;
            delete users[username].bannedBy;
            delete users[username].bannedAt;
            
            localStorage.setItem('typingBattleUsers', JSON.stringify(users));
            targetInput.value = '';
            
            alert(`âœ… User "${username}" has been unbanned!`);
            refreshStats();
        }

        function resetUserProgress() {
            const targetInput = document.getElementById('target-username');
            const username = targetInput.value.trim();
            
            if (!username) {
                alert('Please enter a username!');
                return;
            }
            
            if (username === 'TVEGesdreal') {
                alert('Cannot reset admin progress!');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (!users[username]) {
                alert('User not found!');
                return;
            }
            
            if (confirm(`Are you sure you want to reset all progress for "${username}"? This cannot be undone.`)) {
                users[username].maxLevel = 0;
                users[username].gamesPlayed = 0;
                users[username].gems = 0;
                users[username].title = '';
                users[username].perks = {};
                users[username].ownedTitles = [];
                
                localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                targetInput.value = '';
                
                alert(`ğŸ”„ Progress reset for "${username}"!`);
            }
        }

        function terminateAccount() {
            const targetInput = document.getElementById('target-username');
            const username = targetInput.value.trim();
            
            if (!username) {
                alert('Please enter a username!');
                return;
            }
            
            if (username === 'TVEGesdreal') {
                alert('Cannot terminate the admin account!');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (!users[username]) {
                alert('User not found!');
                return;
            }
            
            if (confirm(`âš ï¸ CRITICAL ACTION: Terminate account "${username}"? This will permanently delete their account and cannot be undone!`)) {
                delete users[username];
                localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                targetInput.value = '';
                
                alert(`ğŸ’€ Account "${username}" has been terminated!`);
                refreshStats();
            }
        }

        function viewUserDetails() {
            const targetInput = document.getElementById('target-username');
            const username = targetInput.value.trim();
            
            if (!username) {
                alert('Please enter a username!');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (!users[username]) {
                alert('User not found!');
                return;
            }
            
            const user = users[username];
            let details = `ğŸ‘¤ User Details for "${username}":\n\n`;
            details += `Max Level: ${user.maxLevel || 0}\n`;
            details += `Games Played: ${user.gamesPlayed || 0}\n`;
            details += `Gems: ${user.gems || 0}\n`;
            details += `Title: ${user.title || 'None'}\n`;
            details += `Premium: ${user.isPremium ? 'Yes' : 'No'}\n`;
            details += `Custom Title: ${user.customTitle || 'None'}\n`;
            details += `Banned: ${user.banned ? 'Yes' : 'No'}\n`;
            details += `Created: ${user.createdAt || 'Unknown'}\n`;
            
            if (user.youtuberTitles && user.youtuberTitles.length > 0) {
                const youtuberTitles = JSON.parse(localStorage.getItem('youtuberTitles') || '{}');
                details += `YouTuber Titles: `;
                const titleNames = user.youtuberTitles.map(id => youtuberTitles[id]?.name || id).join(', ');
                details += titleNames + '\n';
            }
            
            alert(details);
        }

        function giveGems() {
            const targetInput = document.getElementById('target-username');
            const username = targetInput.value.trim();
            
            if (!username) {
                alert('Please enter a username!');
                return;
            }
            
            const amount = prompt('How many gems to give?');
            if (!amount || isNaN(amount) || parseInt(amount) <= 0) {
                alert('Please enter a valid positive number!');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (!users[username]) {
                alert('User not found!');
                return;
            }
            
            users[username].gems = (users[username].gems || 0) + parseInt(amount);
            localStorage.setItem('typingBattleUsers', JSON.stringify(users));
            
            alert(`ğŸ’ Gave ${amount} gems to "${username}"!`);
        }

        function takeGems() {
            const targetInput = document.getElementById('target-username');
            const username = targetInput.value.trim();
            
            if (!username) {
                alert('Please enter a username!');
                return;
            }
            
            const amount = prompt('How many gems to take?');
            if (!amount || isNaN(amount) || parseInt(amount) <= 0) {
                alert('Please enter a valid positive number!');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (!users[username]) {
                alert('User not found!');
                return;
            }
            
            users[username].gems = Math.max(0, (users[username].gems || 0) - parseInt(amount));
            localStorage.setItem('typingBattleUsers', JSON.stringify(users));
            
            alert(`ğŸ’¸ Took ${amount} gems from "${username}"!`);
        }

        function grantPremium() {
            const targetInput = document.getElementById('target-username');
            const username = targetInput.value.trim();
            
            if (!username) {
                alert('Please enter a username!');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (!users[username]) {
                alert('User not found!');
                return;
            }
            
            users[username].isPremium = true;
            users[username].premiumGrantedBy = currentUser;
            users[username].premiumGrantedAt = new Date().toISOString();
            
            localStorage.setItem('typingBattleUsers', JSON.stringify(users));
            
            alert(`â­ Premium granted to "${username}"!`);
            refreshStats();
        }

        function refreshStats() {
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            const userCount = Object.keys(users).length;
            const bannedCount = Object.values(users).filter(user => user.banned).length;
            const premiumCount = Object.values(users).filter(user => user.isPremium).length;
            
            document.getElementById('total-users').textContent = userCount;
            document.getElementById('active-users').textContent = userCount - bannedCount;
            document.getElementById('banned-users').textContent = bannedCount;
            document.getElementById('premium-users').textContent = premiumCount;
        }

        function sendGlobalAnnouncement() {
            const messageInput = document.getElementById('announcement-input');
            const message = messageInput.value.trim();
            
            if (!message) {
                alert('Please enter an announcement message!');
                return;
            }
            
            if (message.length > 200) {
                alert('Announcement must be 200 characters or less!');
                return;
            }
            
            // Store announcement globally
            const announcement = {
                message: message,
                author: 'TVEGesdreal',
                tag: 'ğŸ‘‘ Admin',
                timestamp: Date.now(),
                expires: Date.now() + (5 * 60 * 1000) // 5 minutes
            };
            
            localStorage.setItem('globalAnnouncement', JSON.stringify(announcement));
            messageInput.value = '';
            
            // Show announcement immediately
            showGlobalAnnouncement(announcement);
            
            alert('ğŸ“¢ Global announcement sent! All players will see this message.');
            updateAdminStatus();
        }

        function startGlobalEvent() {
            const eventType = document.getElementById('event-type').value;
            const duration = parseInt(document.getElementById('event-duration').value);
            
            if (!duration || duration < 1 || duration > 60) {
                alert('Please enter a valid duration (1-60 minutes)!');
                return;
            }
            
            const eventData = {
                type: eventType,
                startTime: Date.now(),
                endTime: Date.now() + (duration * 60 * 1000),
                duration: duration
            };
            
            localStorage.setItem('globalEvent', JSON.stringify(eventData));
            globalEvent = eventData;
            eventEndTime = eventData.endTime;
            
            showGlobalEvent();
            startEventTimer();
            
            const eventNames = {
                'double-gems': 'ğŸ’ Double Gems Event',
                'triple-gems': 'ğŸ’ Triple Gems Event',
                'speed-boost': 'âš¡ Speed Boost Event',
                'mega-damage': 'ğŸ’ª Mega Damage Event',
                'boss-rush': 'ğŸ‘¹ Boss Rush Event'
            };
            
            alert(`ğŸ¯ ${eventNames[eventType]} started for ${duration} minutes!`);
            updateAdminStatus();
        }

        function endGlobalEvent() {
            localStorage.removeItem('globalEvent');
            globalEvent = null;
            eventEndTime = null;
            
            if (eventCheckInterval) {
                clearInterval(eventCheckInterval);
                eventCheckInterval = null;
            }
            
            document.getElementById('global-event-banner').style.display = 'none';
            alert('ğŸ›‘ Global event ended!');
            updateAdminStatus();
        }

        function checkGlobalEvents() {
            // Check for active global events
            const savedEvent = localStorage.getItem('globalEvent');
            if (savedEvent) {
                const eventData = JSON.parse(savedEvent);
                if (eventData.endTime > Date.now()) {
                    globalEvent = eventData;
                    eventEndTime = eventData.endTime;
                    showGlobalEvent();
                    startEventTimer();
                } else {
                    localStorage.removeItem('globalEvent');
                }
            }
            
            // Check for active announcements
            const savedAnnouncement = localStorage.getItem('globalAnnouncement');
            if (savedAnnouncement) {
                const announcementData = JSON.parse(savedAnnouncement);
                if (announcementData.expires > Date.now()) {
                    showGlobalAnnouncement(announcementData);
                } else {
                    localStorage.removeItem('globalAnnouncement');
                }
            }
        }

        function showGlobalEvent() {
            if (!globalEvent) return;
            
            const banner = document.getElementById('global-event-banner');
            const eventText = document.getElementById('event-text');
            const eventMultiplier = document.getElementById('event-multiplier');
            
            const eventNames = {
                'double-gems': 'Double Gems Active!',
                'triple-gems': 'Triple Gems Active!',
                'speed-boost': 'Speed Boost Active!',
                'mega-damage': 'Mega Damage Active!',
                'boss-rush': 'Boss Rush Active!'
            };
            
            const eventColors = {
                'double-gems': '#fdcb6e',
                'triple-gems': '#e17055',
                'speed-boost': '#74b9ff',
                'mega-damage': '#ff6b6b',
                'boss-rush': '#8e44ad'
            };
            
            eventText.textContent = eventNames[globalEvent.type] || 'Special Event Active!';
            eventMultiplier.textContent = getEventMultiplierText(globalEvent.type);
            banner.style.background = `linear-gradient(45deg, ${eventColors[globalEvent.type]}, #fff)`;
            banner.style.display = 'block';
        }

        function getEventMultiplierText(eventType) {
            const multipliers = {
                'double-gems': '2x Gems',
                'triple-gems': '3x Gems',
                'speed-boost': 'Faster Typing',
                'mega-damage': '3x Damage',
                'boss-rush': 'All Bosses'
            };
            return multipliers[eventType] || 'Special Effect';
        }

        function showGlobalAnnouncement(announcement) {
            const announcementDiv = document.getElementById('global-announcements');
            const announcementText = document.getElementById('announcement-text');
            const announcementAuthor = document.getElementById('announcement-author');
            
            announcementText.textContent = announcement.message;
            announcementAuthor.textContent = `- ${announcement.tag} ${announcement.author}`;
            announcementDiv.style.display = 'block';
        }

        function closeAnnouncement() {
            document.getElementById('global-announcements').style.display = 'none';
        }

        function startEventTimer() {
            if (eventCheckInterval) {
                clearInterval(eventCheckInterval);
            }
            
            eventCheckInterval = setInterval(() => {
                if (!globalEvent || !eventEndTime) {
                    clearInterval(eventCheckInterval);
                    eventCheckInterval = null;
                    return;
                }
                
                const timeLeft = eventEndTime - Date.now();
                
                if (timeLeft <= 0) {
                    endGlobalEvent();
                } else {
                    // Update admin panel if open
                    const timeRemaining = document.getElementById('event-time-remaining');
                    if (timeRemaining) {
                        const minutes = Math.floor(timeLeft / 60000);
                        const seconds = Math.floor((timeLeft % 60000) / 1000);
                        timeRemaining.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    }
                }
            }, 1000);
        }

        function updateAdminStatus() {
            const currentEventStatus = document.getElementById('current-event-status');
            const eventTimeRemaining = document.getElementById('event-time-remaining');
            const lastAnnouncement = document.getElementById('last-announcement');
            
            if (globalEvent) {
                const eventNames = {
                    'double-gems': 'ğŸ’ Double Gems',
                    'triple-gems': 'ğŸ’ Triple Gems',
                    'speed-boost': 'âš¡ Speed Boost',
                    'mega-damage': 'ğŸ’ª Mega Damage',
                    'boss-rush': 'ğŸ‘¹ Boss Rush'
                };
                currentEventStatus.textContent = eventNames[globalEvent.type] || 'Unknown Event';
            } else {
                currentEventStatus.textContent = 'None';
                eventTimeRemaining.textContent = '-';
            }
            
            const savedAnnouncement = localStorage.getItem('globalAnnouncement');
            if (savedAnnouncement) {
                const announcement = JSON.parse(savedAnnouncement);
                lastAnnouncement.textContent = announcement.message.substring(0, 30) + '...';
            } else {
                lastAnnouncement.textContent = 'None';
            }
        }

        // Initialize the game
        if (checkAuth()) {
            startGame();
        }
    </script>
</body>

</html>
