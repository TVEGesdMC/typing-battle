<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Battle - Infinite Levels!</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="game-container">
        <div class="header">
            <div class="user-info">
                <h2>Welcome, <span id="username"></span>!</h2>
                <div class="stats">
                    Best Level: <span id="best-level">0</span> |
                    Games Played: <span id="games-played">0</span>
                </div>
            </div>
            <div class="nav-links">
                <a href="leaderboard.html">üèÜ Leaderboard</a>
                <a href="#" onclick="logout()" class="btn">Logout</a>
            </div>
        </div>

        <h1>Typing Battle!</h1>
        <p id="level-info">Level: <span id="current-level">1</span></p>
        <div id="monster-area">
            <div class="character">
                <h2 id="monster-name">Monster</h2>
                <p>Health: <span id="monster-health">100</span></p>
            </div>
        </div>
        <div id="player-area">
            <div class="character">
                <h2>Player</h2>
                <p>Health: <span id="player-health">100</span></p>
            </div>
        </div>

        <p id="current-word"></p>
        <div id="cheat-indicator" style="display: none;">üöÄ CHEAT MODE ACTIVE üöÄ</div>
        <input type="text" id="typing-input" placeholder="Type the word...">
        <p id="message" class="message"></p>

        <div style="margin-top: 20px;">
            <button class="btn" onclick="startGame()">New Game</button>
        </div>
    </div>

    <script>
        const words = ["attack", "defend", "magic", "sword", "shield", "spell", "heal", "potion", "strike", "dodge", "ability", "spirit", "valor", "courage", "fury", "enchant", "bless", "curse", "poison", "fire", "ice", "thunder", "earth", "wind", "light", "darkness", "focus", "meditate", "charge", "parry", "slap", "tackle"];
        const bossWords = ["destroyer", "annihilator", "overlord", "tyrant", "colossus", "behemoth", "leviathan", "abomination", "conqueror", "devastator", "ram", "tackle", "shoot", "arrow", "sword", "chargoggagoggmanchauggagoggchaubunagungamaugg", "dragon", "wyvern", "hydra", "golem", "beast", "fiend", "demon", "devil", "angel", "archangel", "archfiend", "archdemon", "Erythrocytapheresis", "Supercalifragilisticexpialidocious"];

        let currentWord = "";
        let monsterHealth = 100;
        let playerHealth = 100;
        let currentLevel = 1;
        let isBossFight = false;
        let currentUser = "";
        let cheatMode = false;
        let cheatInterval = null;

        const monsterHealthSpan = document.getElementById("monster-health");
        const playerHealthSpan = document.getElementById("player-health");
        const currentWordDisplay = document.getElementById("current-word");
        const typingInput = document.getElementById("typing-input");
        const messageDisplay = document.getElementById("message");
        const currentLevelDisplay = document.getElementById("current-level");
        const monsterNameDisplay = document.getElementById("monster-name");
        const cheatIndicator = document.getElementById("cheat-indicator");

        function checkAuth() {
            currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'signup.html';
                return false;
            }

            document.getElementById('username').textContent = currentUser;
            loadUserStats();
            return true;
        }

        function loadUserStats() {
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            const userData = users[currentUser] || {maxLevel: 0, gamesPlayed: 0};

            document.getElementById('best-level').textContent = userData.maxLevel;
            document.getElementById('games-played').textContent = userData.gamesPlayed;
        }

        function updateUserStats(level) {
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (users[currentUser]) {
                users[currentUser].maxLevel = Math.max(users[currentUser].maxLevel || 0, level);
                users[currentUser].gamesPlayed = (users[currentUser].gamesPlayed || 0) + 1;
                localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                loadUserStats();
            }
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'signup.html';
        }

        function toggleCheatMode() {
            cheatMode = !cheatMode;
            cheatIndicator.style.display = cheatMode ? 'block' : 'none';

            if (cheatMode) {
                cheatIndicator.style.color = '#ff6b6b';
                cheatIndicator.style.fontSize = '1.2em';
                cheatIndicator.style.fontWeight = 'bold';
                cheatIndicator.style.animation = 'textGlow 1s ease-in-out infinite alternate';
                cheatIndicator.style.marginTop = '10px';
                autoType();
            } else {
                clearInterval(cheatInterval);
                cheatInterval = null;
            }
        }

        function autoType() {
            if (!cheatMode || typingInput.disabled) return;

            const word = currentWord;
            let index = 0;

            cheatInterval = setInterval(() => {
                if (!cheatMode || typingInput.disabled || index >= word.length) {
                    if (index >= word.length && cheatMode) {
                        // Simulate Enter key press
                        const enterEvent = new KeyboardEvent('keyup', {key: 'Enter'});
                        typingInput.dispatchEvent(enterEvent);
                    }
                    clearInterval(cheatInterval);
                    if (cheatMode && monsterHealth > 0 && !typingInput.disabled) {
                        setTimeout(autoType, 100); // Start typing next word
                    }
                    return;
                }

                typingInput.value = word.substring(0, index + 1);
                index++;
            }, 50); // Type each character every 50ms
        }

        function startGame() {
            playerHealth = 100;
            currentLevel = 1;
            isBossFight = false;
            typingInput.disabled = false;
            monsterNameDisplay.classList.remove("boss");
            document.querySelector('#monster-area .character').classList.remove("boss");
            startLevel();
            updateHealthDisplays();
            typingInput.value = "";
            messageDisplay.textContent = "";
            typingInput.focus();
        }

        function startLevel() {
            currentLevelDisplay.textContent = currentLevel;
            const monsterDiv = document.querySelector('#monster-area .character');

            if (currentLevel % 5 === 0) {
                isBossFight = true;
                monsterHealth = 250;
                monsterNameDisplay.textContent = "BOSS MONSTER";
                monsterNameDisplay.classList.add("boss");
                monsterDiv.classList.add("boss");
            } else {
                isBossFight = false;
                monsterHealth = 100;
                monsterNameDisplay.textContent = "Monster";
                monsterNameDisplay.classList.remove("boss");
                monsterDiv.classList.remove("boss");
            }
            updateHealthDisplays();
            newWord();
        }

        function newWord() {
            let wordList = isBossFight ? bossWords : words;
            const randomIndex = Math.floor(Math.random() * wordList.length);
            currentWord = wordList[randomIndex];
            currentWordDisplay.textContent = currentWord;
        }

        function updateHealthDisplays() {
            monsterHealthSpan.textContent = monsterHealth;
            playerHealthSpan.textContent = playerHealth;
        }

        function attack(target) {
            let damage = Math.floor(Math.random() * 10) + 5;

            if (target === "monster") {
                if (isBossFight) {
                    damage = Math.floor(Math.random() * 20) + 15;
                }
                monsterHealth -= damage;
                if (monsterHealth <= 0) {
                    monsterHealth = 0;
                    if (isBossFight) {
                        messageDisplay.textContent = "You defeated the BOSS!";
                    } else {
                        messageDisplay.textContent = `You defeated the monster!`;
                    }
                    messageDisplay.classList.add("correct");
                    messageDisplay.classList.remove("incorrect");
                    levelUp();
                } else {
                    messageDisplay.textContent = `You dealt ${damage} damage to the ${monsterNameDisplay.textContent}!`;
                    messageDisplay.classList.add("correct");
                    messageDisplay.classList.remove("incorrect");
                }
            } else if (target === "player") {
                let monsterDamage = Math.floor(Math.random() * 12) + 8;

                if (isBossFight) {
                    monsterDamage = Math.floor(Math.random() * 25) + 20;
                }

                playerHealth -= monsterDamage;
                if (playerHealth <= 0) {
                    playerHealth = 0;
                    endGame("The monster defeated you!");
                } else {
                    messageDisplay.textContent = `The ${monsterNameDisplay.textContent} dealt ${monsterDamage} damage to you!`;
                    messageDisplay.classList.add("incorrect");
                    messageDisplay.classList.remove("correct");
                }
            }
            updateHealthDisplays();
        }

        function levelUp() {
            currentLevel++;
            setTimeout(() => {
                startLevel();
            }, 1500);
        }

        function endGame(result) {
            currentWordDisplay.textContent = result;
            typingInput.disabled = true;
            messageDisplay.textContent = "Game Over! Click 'New Game' to play again.";
            messageDisplay.classList.add("game-over");
            updateUserStats(currentLevel - 1);
        }

        // Global keyboard listener for cheat activation
        document.addEventListener("keydown", (event) => {
            if (event.ctrlKey && event.altKey && event.key === 'c') {
                event.preventDefault();
                toggleCheatMode();
            }
        });

        typingInput.addEventListener("keyup", (event) => {
            if (typingInput.disabled) return;

            if (event.key === "Enter") {
                if (typingInput.value.toLowerCase() === currentWord) {
                    attack("monster");
                    if (monsterHealth > 0) {
                        newWord();
                        if (cheatMode) {
                            setTimeout(autoType, 100);
                        }
                    }
                } else {
                    messageDisplay.textContent = "Incorrect word! Monster attacks!";
                    messageDisplay.classList.add("incorrect");
                    messageDisplay.classList.remove("correct");
                    attack("player");
                    newWord();
                    if (cheatMode) {
                        setTimeout(autoType, 100);
                    }
                }
                typingInput.value = "";
            }
        });

        // Initialize the game
        if (checkAuth()) {
            startGame();
        }
    </script>
</body>

</html>
