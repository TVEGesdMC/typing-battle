<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Battle - Infinite Levels!</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="game-container">
        <div class="header">
            <div class="user-info">
                <h2><span id="player-title"></span><span id="username"></span>!</h2>
                <div class="stats">
                    ğŸ’ Gems: <span id="gems-count">0</span> |
                    Best Level: <span id="best-level">0</span> |
                    Games Played: <span id="games-played">0</span>
                </div>
            </div>
            <div class="nav-links">
                <a href="leaderboard.html">ğŸ† Leaderboard</a>
                <a href="#" onclick="toggleShop()" class="btn">ğŸ›’ Shop</a>
                <a href="#" onclick="togglePremium()" class="btn">ğŸ’ Premium</a>
                <a href="#" onclick="logout()" class="btn">Logout</a>
            </div>
        </div>

        <h1>Typing Battle!</h1>
        <p id="level-info">Level: <span id="current-level">1</span></p>
        <div id="monster-area">
            <div class="character">
                <h2 id="monster-name">Monster</h2>
                <p>Health: <span id="monster-health">100</span></p>
            </div>
        </div>
        <div id="player-area">
            <div class="character">
                <h2>Player</h2>
                <p>Health: <span id="player-health">100</span></p>
            </div>
        </div>

        <p id="current-word"></p>
        <div id="cheat-indicator" style="display: none;">ğŸš€ CHEAT MODE ACTIVE ğŸš€</div>
        <input type="text" id="typing-input" placeholder="Type the word...">
        <p id="message" class="message"></p>

        <div style="margin-top: 20px;">
            <button class="btn" onclick="startGame()">New Game</button>
        </div>
    </div>

    <!-- Shop Interface -->
    <div id="shop-overlay" class="shop-overlay" style="display: none;">
        <div class="shop-container">
            <div class="shop-header">
                <h2>âš”ï¸ Warrior's Shop âš”ï¸</h2>
                <span class="close-shop" onclick="toggleShop()">&times;</span>
            </div>
            
            <div class="gems-display">
                ğŸ’ Your Gems: <span id="shop-gems">0</span>
            </div>

            <div class="shop-tabs">
                <button class="tab-btn active" onclick="showTab('titles')">ğŸ… Titles</button>
                <button class="tab-btn" onclick="showTab('perks')">âš¡ Perks</button>
            </div>

            <div id="titles-tab" class="shop-tab active">
                <h3>ğŸ… Titles (Permanent)</h3>
                <div style="margin-bottom: 20px;">
                    <button class="btn btn-secondary" onclick="unequipTitle()">âŒ Remove Current Title</button>
                </div>
                <div class="shop-items">
                    <!-- Regular Titles -->
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ—¡ï¸ Sword Master</h4>
                            <p>Show your mastery with blades</p>
                        </div>
                        <div class="item-price">
                            <span class="price">500 ğŸ’</span>
                            <button onclick="buyItem('title', 'swordmaster', 500)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ† Champion</h4>
                            <p>For true heroes of the arena</p>
                        </div>
                        <div class="item-price">
                            <span class="price">1000 ğŸ’</span>
                            <button onclick="buyItem('title', 'champion', 1000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ‘‘ Legendary</h4>
                            <p>Reserved for legends only</p>
                        </div>
                        <div class="item-price">
                            <span class="price">2500 ğŸ’</span>
                            <button onclick="buyItem('title', 'legendary', 2500)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ”¥ Pyromaniac</h4>
                            <p>Burns through enemies like fire</p>
                        </div>
                        <div class="item-price">
                            <span class="price">1500 ğŸ’</span>
                            <button onclick="buyItem('title', 'pyromaniac', 1500)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>âš¡ Lightning Fingers</h4>
                            <p>Types faster than lightning strikes</p>
                        </div>
                        <div class="item-price">
                            <span class="price">2000 ğŸ’</span>
                            <button onclick="buyItem('title', 'lightning', 2000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸŒŸ Starborn</h4>
                            <p>Born from the stars themselves</p>
                        </div>
                        <div class="item-price">
                            <span class="price">3000 ğŸ’</span>
                            <button onclick="buyItem('title', 'starborn', 3000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    
                    <!-- Premium Only Titles -->
                    <div class="shop-section-divider" style="margin: 20px 0; padding: 10px; background: linear-gradient(45deg, #fdcb6e, #e17055); border-radius: 10px; color: white; text-align: center; font-weight: bold;">
                        âœ¨ PREMIUM EXCLUSIVE TITLES âœ¨
                    </div>
                    <div class="shop-item premium-only">
                        <div class="item-info">
                            <h4>ğŸŒˆ Reality Bender</h4>
                            <p>Bends the laws of typing reality (Premium Only)</p>
                        </div>
                        <div class="item-price">
                            <span class="price">5000 ğŸ’</span>
                            <button onclick="buyItem('title', 'realitybender', 5000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item premium-only">
                        <div class="item-info">
                            <h4>ğŸ’€ Death's Typist</h4>
                            <p>Even Death fears your typing speed (Premium Only)</p>
                        </div>
                        <div class="item-price">
                            <span class="price">6000 ğŸ’</span>
                            <button onclick="buyItem('title', 'deathstypist', 6000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item premium-only">
                        <div class="item-info">
                            <h4>ğŸš€ Quantum Warrior</h4>
                            <p>Exists in multiple typing dimensions (Premium Only)</p>
                        </div>
                        <div class="item-price">
                            <span class="price">7500 ğŸ’</span>
                            <button onclick="buyItem('title', 'quantum', 7500)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item premium-only">
                        <div class="item-info">
                            <h4>ğŸŒŒ Universe Destroyer</h4>
                            <p>Your typing destroys entire universes (Premium Only)</p>
                        </div>
                        <div class="item-price">
                            <span class="price">10000 ğŸ’</span>
                            <button onclick="buyItem('title', 'universedestroyer', 10000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item premium-only">
                        <div class="item-info">
                            <h4>ğŸ‘ï¸ The All-Seeing Typer</h4>
                            <p>Sees all words before they appear (Premium Only)</p>
                        </div>
                        <div class="item-price">
                            <span class="price">12000 ğŸ’</span>
                            <button onclick="buyItem('title', 'allseeing', 12000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item premium-only">
                        <div class="item-info">
                            <h4>ğŸ”® Mystic Wordweaver</h4>
                            <p>Weaves words from pure magic (Premium Only)</p>
                        </div>
                        <div class="item-price">
                            <span class="price">8000 ğŸ’</span>
                            <button onclick="buyItem('title', 'wordweaver', 8000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item premium-only">
                        <div class="item-info">
                            <h4>âš¡ Godslayer Typist</h4>
                            <p>Even gods fear your keyboard (Premium Only)</p>
                        </div>
                        <div class="item-price">
                            <span class="price">15000 ğŸ’</span>
                            <button onclick="buyItem('title', 'godslayer', 15000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="perks-tab" class="shop-tab">
                <h3>âš¡ Combat Perks (Permanent)</h3>
                <div class="shop-items">
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ’ª Double Damage</h4>
                            <p>Deal 2x damage to monsters</p>
                        </div>
                        <div class="item-price">
                            <span class="price">800 ğŸ’</span>
                            <button onclick="buyItem('perk', 'doubleDamage', 800)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>â¤ï¸ Extra Health</h4>
                            <p>Start with 150 health instead of 100</p>
                        </div>
                        <div class="item-price">
                            <span class="price">600 ğŸ’</span>
                            <button onclick="buyItem('perk', 'extraHealth', 600)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>âš¡ Fast Typing</h4>
                            <p>Monsters take longer to attack</p>
                        </div>
                        <div class="item-price">
                            <span class="price">700 ğŸ’</span>
                            <button onclick="buyItem('perk', 'fastTyping', 700)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ’ Gem Collector</h4>
                            <p>Earn 50% more gems per level</p>
                        </div>
                        <div class="item-price">
                            <span class="price">1200 ğŸ’</span>
                            <button onclick="buyItem('perk', 'gemBonus', 1200)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Premium Interface -->
    <div id="premium-overlay" class="shop-overlay" style="display: none;">
        <div class="shop-container">
            <div class="shop-header">
                <h2>ğŸ’ Premium Membership</h2>
                <span class="close-shop" onclick="togglePremium()">&times;</span>
            </div>
            
            <div id="premium-content">
                <!-- This will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script>
        const words = ["attack", "defend", "magic", "sword", "shield", "spell", "heal", "potion", "strike", "dodge", "ability", "spirit", "valor", "courage", "fury", "enchant", "bless", "curse", "poison", "fire", "ice", "thunder", "earth", "wind", "light", "darkness", "focus", "meditate", "charge", "parry", "slap", "tackle"];
        const bossWords = ["destroyer", "annihilator", "overlord", "tyrant", "colossus", "behemoth", "leviathan", "abomination", "conqueror", "devastator", "ram", "tackle", "shoot", "arrow", "sword", "chargoggagoggmanchauggagoggchaubunagungamaugg", "dragon", "wyvern", "hydra", "golem", "beast", "fiend", "demon", "devil", "angel", "archangel", "archfiend", "archdemon", "Erythrocytapheresis", "Supercalifragilisticexpialidocious"];

        let currentWord = "";
        let monsterHealth = 100;
        let playerHealth = 100;
        let currentLevel = 1;
        let isBossFight = false;
        let currentUser = "";
        let cheatMode = false;
        let cheatInterval = null;
        let gems = 0;
        let shopVisible = false;
        let playerTitle = "";
        let isPremium = false;
        let customTitle = "";
        let playerPerks = {
            doubleDamage: false,
            extraHealth: false,
            fastTyping: false,
            gemBonus: false
        };

        const monsterHealthSpan = document.getElementById("monster-health");
        const playerHealthSpan = document.getElementById("player-health");
        const currentWordDisplay = document.getElementById("current-word");
        const typingInput = document.getElementById("typing-input");
        const messageDisplay = document.getElementById("message");
        const currentLevelDisplay = document.getElementById("current-level");
        const monsterNameDisplay = document.getElementById("monster-name");
        const cheatIndicator = document.getElementById("cheat-indicator");

        function checkAuth() {
            currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'signup.html';
                return false;
            }

            document.getElementById('username').textContent = currentUser;
            loadUserStats();
            return true;
        }

        function loadUserStats() {
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            const userData = users[currentUser] || {maxLevel: 0, gamesPlayed: 0, gems: 0, title: '', perks: {}, isPremium: false, customTitle: '', ownedTitles: []};

            gems = userData.gems || 0;
            playerTitle = userData.title || '';
            isPremium = userData.isPremium || false;
            
            // Auto-activate premium for special username
            if (currentUser === 'TVEGesdreal' && !isPremium) {
                isPremium = true;
                userData.isPremium = true;
                users[currentUser] = userData;
                localStorage.setItem('typingBattleUsers', JSON.stringify(users));
            }
            customTitle = userData.customTitle || '';
            playerPerks = userData.perks || {doubleDamage: false, extraHealth: false, fastTyping: false, gemBonus: false};
            
            // Ensure ownedTitles exists and includes current title
            if (!userData.ownedTitles) {
                userData.ownedTitles = [];
                if (playerTitle && !userData.ownedTitles.includes(playerTitle)) {
                    userData.ownedTitles.push(playerTitle);
                    users[currentUser] = userData;
                    localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                }
            }

            document.getElementById('best-level').textContent = userData.maxLevel;
            document.getElementById('games-played').textContent = userData.gamesPlayed;
            document.getElementById('gems-count').textContent = gems;
            document.getElementById('shop-gems').textContent = gems;
            
            // Update title display
            const titleElement = document.getElementById('player-title');
            if (isPremium && customTitle) {
                titleElement.innerHTML = `âœ¨ ${customTitle} `;
                titleElement.style.color = '#e17055';
            } else if (playerTitle) {
                const titleText = getTitleText(playerTitle);
                titleElement.textContent = titleText + ' ';
                titleElement.style.color = getTitleColor(playerTitle);
            } else {
                titleElement.textContent = 'Welcome, ';
                titleElement.style.color = '#333';
            }
            
            updateShopButtons();
        }

        function updateUserStats(level) {
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (users[currentUser]) {
                users[currentUser].maxLevel = Math.max(users[currentUser].maxLevel || 0, level);
                users[currentUser].gamesPlayed = (users[currentUser].gamesPlayed || 0) + 1;
                users[currentUser].gems = gems;
                users[currentUser].title = playerTitle;
                users[currentUser].perks = playerPerks;
                users[currentUser].isPremium = isPremium;
                users[currentUser].customTitle = customTitle;
                localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                loadUserStats();
            }
        }

        function saveUserData() {
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (users[currentUser]) {
                users[currentUser].gems = gems;
                users[currentUser].title = playerTitle;
                users[currentUser].perks = playerPerks;
                users[currentUser].isPremium = isPremium;
                users[currentUser].customTitle = customTitle;
                localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                loadUserStats();
            }
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'signup.html';
        }

        function toggleCheatMode() {
            cheatMode = !cheatMode;
            cheatIndicator.style.display = cheatMode ? 'block' : 'none';

            if (cheatMode) {
                cheatIndicator.style.color = '#ff6b6b';
                cheatIndicator.style.fontSize = '1.2em';
                cheatIndicator.style.fontWeight = 'bold';
                cheatIndicator.style.animation = 'textGlow 1s ease-in-out infinite alternate';
                cheatIndicator.style.marginTop = '10px';
                
                // Immediately start typing the current word if game is active
                if (currentWord && !typingInput.disabled) {
                    setTimeout(autoType, 100);
                }
            } else {
                if (cheatInterval) {
                    clearInterval(cheatInterval);
                    cheatInterval = null;
                }
            }
        }

        function autoType() {
            if (!cheatMode || typingInput.disabled || !currentWord) return;

            // Clear any existing interval
            if (cheatInterval) {
                clearInterval(cheatInterval);
            }

            const word = currentWord;
            let index = 0;
            typingInput.value = ""; // Clear input before starting

            cheatInterval = setInterval(() => {
                if (!cheatMode || typingInput.disabled || index >= word.length) {
                    if (index >= word.length && cheatMode && !typingInput.disabled) {
                        // Simulate Enter key press after a short delay
                        setTimeout(() => {
                            if (cheatMode && !typingInput.disabled) {
                                const enterEvent = new KeyboardEvent('keyup', {key: 'Enter'});
                                typingInput.dispatchEvent(enterEvent);
                            }
                        }, 100);
                    }
                    clearInterval(cheatInterval);
                    cheatInterval = null;
                    return;
                }

                typingInput.value = word.substring(0, index + 1);
                index++;
            }, 30); // Faster typing - 30ms per character
        }

        function startGame() {
            playerHealth = playerPerks.extraHealth ? 150 : 100;
            currentLevel = 1;
            isBossFight = false;
            typingInput.disabled = false;
            monsterNameDisplay.classList.remove("boss");
            document.querySelector('#monster-area .character').classList.remove("boss");
            startLevel();
            updateHealthDisplays();
            typingInput.value = "";
            messageDisplay.textContent = "";
            typingInput.focus();
        }

        function startLevel() {
            currentLevelDisplay.textContent = currentLevel;
            const monsterDiv = document.querySelector('#monster-area .character');

            if (currentLevel % 5 === 0) {
                isBossFight = true;
                monsterHealth = 250;
                monsterNameDisplay.textContent = "BOSS MONSTER";
                monsterNameDisplay.classList.add("boss");
                monsterDiv.classList.add("boss");
            } else {
                isBossFight = false;
                monsterHealth = 100;
                monsterNameDisplay.textContent = "Monster";
                monsterNameDisplay.classList.remove("boss");
                monsterDiv.classList.remove("boss");
            }
            updateHealthDisplays();
            newWord();
        }

        function newWord() {
            let wordList = isBossFight ? bossWords : words;
            const randomIndex = Math.floor(Math.random() * wordList.length);
            currentWord = wordList[randomIndex];
            currentWordDisplay.textContent = currentWord;
            
            // If cheat mode is active, automatically start typing the new word
            if (cheatMode && !typingInput.disabled) {
                setTimeout(autoType, 200);
            }
        }

        function updateHealthDisplays() {
            monsterHealthSpan.textContent = monsterHealth;
            playerHealthSpan.textContent = playerHealth;
        }

        function attack(target) {
            let damage = Math.floor(Math.random() * 10) + 5;

            if (target === "monster") {
                if (isBossFight) {
                    damage = Math.floor(Math.random() * 20) + 15;
                }
                
                // Apply double damage perk
                if (playerPerks.doubleDamage) {
                    damage *= 2;
                }
                
                monsterHealth -= damage;
                if (monsterHealth <= 0) {
                    monsterHealth = 0;
                    
                    // Award gems for defeating monster
                    let gemsEarned = 100;
                    if (isBossFight) {
                        gemsEarned = 250; // Bonus for boss
                    }
                    if (playerPerks.gemBonus) {
                        gemsEarned = Math.floor(gemsEarned * 1.5);
                    }
                    if (isPremium) {
                        gemsEarned *= 2; // Premium double gems
                    }
                    
                    gems += gemsEarned;
                    document.getElementById('gems-count').textContent = gems;
                    document.getElementById('shop-gems').textContent = gems;
                    
                    if (isBossFight) {
                        messageDisplay.textContent = `You defeated the BOSS! +${gemsEarned} gems!`;
                    } else {
                        messageDisplay.textContent = `You defeated the monster! +${gemsEarned} gems!`;
                    }
                    messageDisplay.classList.add("correct");
                    messageDisplay.classList.remove("incorrect");
                    levelUp();
                } else {
                    messageDisplay.textContent = `You dealt ${damage} damage to the ${monsterNameDisplay.textContent}!`;
                    messageDisplay.classList.add("correct");
                    messageDisplay.classList.remove("incorrect");
                }
            } else if (target === "player") {
                let monsterDamage = Math.floor(Math.random() * 12) + 8;

                if (isBossFight) {
                    monsterDamage = Math.floor(Math.random() * 25) + 20;
                }

                // Fast typing perk reduces monster damage
                if (playerPerks.fastTyping) {
                    monsterDamage = Math.floor(monsterDamage * 0.7);
                }

                playerHealth -= monsterDamage;
                if (playerHealth <= 0) {
                    playerHealth = 0;
                    endGame("The monster defeated you!");
                } else {
                    messageDisplay.textContent = `The ${monsterNameDisplay.textContent} dealt ${monsterDamage} damage to you!`;
                    messageDisplay.classList.add("incorrect");
                    messageDisplay.classList.remove("correct");
                }
            }
            updateHealthDisplays();
        }

        function levelUp() {
            currentLevel++;
            setTimeout(() => {
                startLevel();
            }, 1500);
        }

        function endGame(result) {
            currentWordDisplay.textContent = result;
            typingInput.disabled = true;
            messageDisplay.textContent = "Game Over! Click 'New Game' to play again.";
            messageDisplay.classList.add("game-over");
            updateUserStats(currentLevel - 1);
        }

        // Global keyboard listener for cheat activation
        document.addEventListener("keydown", (event) => {
            if (event.ctrlKey && event.altKey && event.key === 'c') {
                event.preventDefault();
                toggleCheatMode();
            }
        });

        typingInput.addEventListener("keyup", (event) => {
            if (typingInput.disabled) return;

            if (event.key === "Enter") {
                if (typingInput.value.toLowerCase() === currentWord) {
                    attack("monster");
                    if (monsterHealth > 0) {
                        newWord();
                    }
                } else {
                    messageDisplay.textContent = "Incorrect word! Monster attacks!";
                    messageDisplay.classList.add("incorrect");
                    messageDisplay.classList.remove("correct");
                    attack("player");
                    newWord();
                }
                typingInput.value = "";
            }
        });

        // Premium Functions
        function togglePremium() {
            const premiumVisible = document.getElementById('premium-overlay').style.display === 'flex';
            document.getElementById('premium-overlay').style.display = premiumVisible ? 'none' : 'flex';
            if (!premiumVisible) {
                updatePremiumContent();
            }
        }

        function updatePremiumContent() {
            const content = document.getElementById('premium-content');
            
            // Check for special username that gets free premium
            if (currentUser === 'TVEGesdreal' && !isPremium) {
                isPremium = true;
                saveUserData();
                alert('ğŸŒŸ Welcome VIP! Premium activated automatically for your account!');
            }
            
            if (isPremium) {
                content.innerHTML = `
                    <div class="premium-status">
                        âœ¨ Premium Active âœ¨
                    </div>
                    <div style="text-align: center; margin: 20px 0;">
                        <h3>Premium Benefits Active:</h3>
                        <p>ğŸ’ Double gems earned</p>
                        <p>âœ¨ Custom title available</p>
                        <p>ğŸ¯ Priority support</p>
                        <p>ğŸª Access to exclusive premium titles</p>
                    </div>
                    <div style="margin: 20px 0;">
                        <h4>Custom Title:</h4>
                        <input type="text" id="custom-title-input" class="custom-title-input" 
                               placeholder="Enter your custom title..." value="${customTitle}" maxlength="20">
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button class="btn" onclick="setCustomTitle()">Update Title</button>
                            <button class="btn btn-secondary" onclick="disableCustomTitle()">âŒ Disable Custom Title</button>
                        </div>
                    </div>
                    <div style="margin: 20px 0; padding-top: 20px; border-top: 2px solid #ddd;">
                        <h4 style="color: #e17055;">âš ï¸ Disable Premium</h4>
                        <p style="color: #636e72; font-size: 0.9em;">Warning: You'll need to pay again to reactivate</p>
                        <button class="btn" style="background: linear-gradient(45deg, #e17055, #d63031);" onclick="disablePremium()">
                            ğŸš« Disable Premium
                        </button>
                    </div>
                `;
            } else {
                content.innerHTML = `
                    <div class="premium-banner">
                        <h3>ğŸŒŸ Upgrade to Premium! ğŸŒŸ</h3>
                        <p>ğŸ’ <strong>Double gems</strong> from all battles</p>
                        <p>âœ¨ <strong>Custom titles</strong> for ultimate personalization</p>
                        <p>ğŸª <strong>Exclusive premium titles</strong> in the shop</p>
                        <p>ğŸ¯ <strong>Priority support</strong> and exclusive features</p>
                        <p><strong>One-time payment: $1.99</strong></p>
                        <a href="https://cash.app/$TVEGESD" target="_blank" class="premium-btn">
                            ğŸ’³ Buy Premium - $1.99
                        </a>
                        <div style="margin-top: 15px;">
                            <h4>Receipt Verification Required:</h4>
                            <p style="font-size: 0.9em; color: #636e72; margin-bottom: 10px;">
                                Upload your Cash App receipt showing $1.99 payment to $TVEGESD from today
                            </p>
                            <input type="url" id="receipt-link" placeholder="Paste your Cash App receipt link here..." class="custom-title-input" style="margin-bottom: 10px;">
                            <button class="btn btn-secondary" onclick="verifyReceipt()">
                                ğŸ“„ Verify Receipt & Activate Premium
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        function verifyReceipt() {
            const linkInput = document.getElementById('receipt-link');
            const receiptLink = linkInput.value.trim();
            
            if (!receiptLink) {
                alert('âš ï¸ Please paste your receipt link first!');
                return;
            }
            
            if (!receiptLink.startsWith('http')) {
                alert('âš ï¸ Please enter a valid link starting with http or https');
                return;
            }
            
            const today = new Date().toDateString();
            
            // Simulate receipt verification (in a real app, this would be server-side)
            const verificationPrompt = prompt(`Receipt Verification:
            
Please confirm the following details from your receipt link:
1. Amount paid: $1.99
2. Recipient: $TVEGESD
3. Date: ${today}

Type "VERIFIED" if all details match exactly:`);
            
            if (verificationPrompt === "VERIFIED") {
                isPremium = true;
                const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
                if (users[currentUser]) {
                    users[currentUser].premiumActivationDate = today;
                    localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                }
                saveUserData();
                updatePremiumContent();
                alert('ğŸŒŸ Premium activated! You now earn double gems, can set custom titles, and access exclusive premium titles in the shop!');
            } else {
                alert('âŒ Sorry, you did not pay for premium. Please ensure your receipt shows exactly $1.99 paid to $TVEGESD from today.');
            }
        }

        function disablePremium() {
            if (confirm('âš ï¸ Are you sure you want to disable Premium? You will lose all premium benefits and need to pay again to reactivate.')) {
                isPremium = false;
                customTitle = '';
                saveUserData();
                updatePremiumContent();
                alert('ğŸš« Premium has been disabled. You will need to purchase again to reactivate.');
            }
        }

        function setCustomTitle() {
            const titleInput = document.getElementById('custom-title-input');
            const newTitle = titleInput.value.trim();
            
            if (newTitle.length === 0) {
                alert('Please enter a title!');
                return;
            }
            
            if (newTitle.length > 20) {
                alert('Title must be 20 characters or less!');
                return;
            }
            
            customTitle = newTitle;
            saveUserData();
            alert('âœ¨ Custom title updated!');
        }

        function disableCustomTitle() {
            if (!customTitle) {
                alert('No custom title is currently active!');
                return;
            }
            
            if (confirm('âš ï¸ Are you sure you want to disable your custom title? You can create a new one anytime.')) {
                customTitle = '';
                const titleInput = document.getElementById('custom-title-input');
                if (titleInput) {
                    titleInput.value = '';
                }
                saveUserData();
                alert('âŒ Custom title disabled!');
            }
        }

        // Shop Functions
        function toggleShop() {
            shopVisible = !shopVisible;
            document.getElementById('shop-overlay').style.display = shopVisible ? 'flex' : 'none';
            if (shopVisible) {
                updateShopButtons();
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.shop-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
        }

        function buyItem(type, item, price) {
            if (gems < price) {
                alert('Not enough gems! ğŸ’');
                return;
            }

            // Get user's owned titles
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            const userData = users[currentUser] || {};
            const ownedTitles = userData.ownedTitles || [];

            // Check if trying to buy premium title without premium
            const premiumTitles = ['realitybender', 'deathstypist', 'quantum', 'universedestroyer', 'allseeing', 'wordweaver', 'godslayer'];
            if (type === 'title' && premiumTitles.includes(item) && !isPremium) {
                alert('ğŸŒŸ Premium membership required to purchase this title! Upgrade to Premium first.');
                return;
            }

            if (type === 'title') {
                if (ownedTitles.includes(item)) {
                    alert('You already own this title! ğŸ‘‘');
                    return;
                }
                ownedTitles.push(item);
                playerTitle = item; // Automatically equip new title
                gems -= price;
                
                // Update user data with owned titles
                users[currentUser].ownedTitles = ownedTitles;
                localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                
                alert('Title purchased and equipped! âœ¨');
            } else if (type === 'perk') {
                if (playerPerks[item]) {
                    alert('You already own this perk! âš¡');
                    return;
                }
                playerPerks[item] = true;
                gems -= price;
                alert('Perk purchased! Your power grows! ğŸ’ª');
            }

            saveUserData();
            updateShopButtons();
        }

        function equipTitle(titleItem) {
            playerTitle = titleItem;
            saveUserData();
            updateShopButtons();
            
            const titleText = getTitleText(titleItem);
            alert(`Title equipped: ${titleText} âœ¨`);
        }

        function unequipTitle() {
            if (!playerTitle) {
                alert('No title currently equipped!');
                return;
            }
            
            playerTitle = '';
            saveUserData();
            updateShopButtons();
            alert('Title removed! âŒ');
        }

        function updateShopButtons() {
            // Update gems display
            document.getElementById('gems-count').textContent = gems;
            document.getElementById('shop-gems').textContent = gems;

            // Get user's owned titles
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            const userData = users[currentUser] || {};
            const ownedTitles = userData.ownedTitles || [];

            const premiumTitles = ['realitybender', 'deathstypist', 'quantum', 'universedestroyer', 'allseeing', 'wordweaver', 'godslayer'];

            // Update buy buttons and premium-only items
            document.querySelectorAll('.buy-btn').forEach(btn => {
                const onclick = btn.getAttribute('onclick');
                const match = onclick.match(/buyItem\('(\w+)', '(\w+)', (\d+)\)/);
                if (match) {
                    const [, type, item, price] = match;
                    
                    if (type === 'title' && ownedTitles.includes(item)) {
                        if (playerTitle === item) {
                            btn.textContent = 'Equipped';
                            btn.disabled = true;
                            btn.style.opacity = '0.5';
                            btn.style.background = 'linear-gradient(45deg, #00b894, #00a085)';
                        } else {
                            btn.textContent = 'Equip';
                            btn.disabled = false;
                            btn.style.opacity = '1';
                            btn.style.background = 'linear-gradient(45deg, #74b9ff, #0984e3)';
                            btn.setAttribute('onclick', `equipTitle('${item}')`);
                        }
                    } else if (type === 'perk' && playerPerks[item]) {
                        btn.textContent = 'Owned';
                        btn.disabled = true;
                        btn.style.opacity = '0.5';
                    } else if (type === 'title' && premiumTitles.includes(item) && !isPremium) {
                        btn.textContent = 'Premium Required';
                        btn.disabled = true;
                        btn.style.opacity = '0.5';
                    } else if (gems < parseInt(price)) {
                        btn.disabled = true;
                        btn.style.opacity = '0.5';
                    } else {
                        btn.textContent = 'Buy';
                        btn.disabled = false;
                        btn.style.opacity = '1';
                        btn.style.background = 'linear-gradient(45deg, #00b894, #00a085)';
                    }
                }
            });

            // Style premium-only items
            document.querySelectorAll('.premium-only').forEach(item => {
                if (!isPremium) {
                    item.style.opacity = '0.6';
                    item.style.background = 'linear-gradient(145deg, #f8f9fa, #e9ecef)';
                    item.style.border = '2px dashed #dee2e6';
                } else {
                    item.style.opacity = '1';
                    item.style.background = 'linear-gradient(145deg, #fff5e6, #ffe0b3)';
                    item.style.border = '2px solid #fdcb6e';
                }
            });
        }

        function getTitleText(title) {
            const titles = {
                'swordmaster': 'ğŸ—¡ï¸ Sword Master',
                'champion': 'ğŸ† Champion',
                'legendary': 'ğŸ‘‘ Legendary',
                'pyromaniac': 'ğŸ”¥ Pyromaniac',
                'lightning': 'âš¡ Lightning Fingers',
                'starborn': 'ğŸŒŸ Starborn',
                'realitybender': 'ğŸŒˆ Reality Bender',
                'deathstypist': 'ğŸ’€ Death\'s Typist',
                'quantum': 'ğŸš€ Quantum Warrior',
                'universedestroyer': 'ğŸŒŒ Universe Destroyer',
                'allseeing': 'ğŸ‘ï¸ All-Seeing Typer',
                'wordweaver': 'ğŸ”® Mystic Wordweaver',
                'godslayer': 'âš¡ Godslayer Typist'
            };
            return titles[title] || '';
        }

        function getTitleColor(title) {
            const colors = {
                'swordmaster': '#74b9ff',
                'champion': '#fdcb6e',
                'legendary': '#e17055',
                'pyromaniac': '#ff6b6b',
                'lightning': '#f39c12',
                'starborn': '#9b59b6',
                'realitybender': '#e74c3c',
                'deathstypist': '#2c3e50',
                'quantum': '#3498db',
                'universedestroyer': '#8e44ad',
                'allseeing': '#d35400',
                'wordweaver': '#27ae60',
                'godslayer': '#c0392b'
            };
            return colors[title] || '#333';
        }

        // Initialize the game
        if (checkAuth()) {
            startGame();
        }
    </script>
</body>

</html>
