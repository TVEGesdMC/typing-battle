<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Battle - Infinite Levels!</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div id="game-container">
        <div class="header">
            <div class="user-info">
                <h2><span id="player-title"></span><span id="username"></span>!</h2>
                <div class="stats">
                    ğŸ’ Gems: <span id="gems-count">0</span> |
                    Best Level: <span id="best-level">0</span> |
                    Games Played: <span id="games-played">0</span>
                </div>
            </div>
            <div class="nav-links">
                <a href="leaderboard.html">ğŸ† Leaderboard</a>
                <a href="#" onclick="toggleShop()" class="btn">ğŸ›’ Shop</a>
                <a href="#" onclick="logout()" class="btn">Logout</a>
            </div>
        </div>

        <h1>Typing Battle!</h1>
        <p id="level-info">Level: <span id="current-level">1</span></p>
        <div id="monster-area">
            <div class="character">
                <h2 id="monster-name">Monster</h2>
                <p>Health: <span id="monster-health">100</span></p>
            </div>
        </div>
        <div id="player-area">
            <div class="character">
                <h2>Player</h2>
                <p>Health: <span id="player-health">100</span></p>
            </div>
        </div>

        <p id="current-word"></p>
        <div id="cheat-indicator" style="display: none;">ğŸš€ CHEAT MODE ACTIVE ğŸš€</div>
        <input type="text" id="typing-input" placeholder="Type the word...">
        <p id="message" class="message"></p>

        <div style="margin-top: 20px;">
            <button class="btn" onclick="startGame()">New Game</button>
        </div>
    </div>

    <!-- Shop Interface -->
    <div id="shop-overlay" class="shop-overlay" style="display: none;">
        <div class="shop-container">
            <div class="shop-header">
                <h2>âš”ï¸ Warrior's Shop âš”ï¸</h2>
                <span class="close-shop" onclick="toggleShop()">&times;</span>
            </div>
            
            <div class="gems-display">
                ğŸ’ Your Gems: <span id="shop-gems">0</span>
            </div>

            <div class="shop-tabs">
                <button class="tab-btn active" onclick="showTab('titles')">ğŸ… Titles</button>
                <button class="tab-btn" onclick="showTab('perks')">âš¡ Perks</button>
            </div>

            <div id="titles-tab" class="shop-tab active">
                <h3>ğŸ… Titles (Permanent)</h3>
                <div class="shop-items">
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ—¡ï¸ Sword Master</h4>
                            <p>Show your mastery with blades</p>
                        </div>
                        <div class="item-price">
                            <span class="price">500 ğŸ’</span>
                            <button onclick="buyItem('title', 'swordmaster', 500)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ† Champion</h4>
                            <p>For true heroes of the arena</p>
                        </div>
                        <div class="item-price">
                            <span class="price">1000 ğŸ’</span>
                            <button onclick="buyItem('title', 'champion', 1000)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ‘‘ Legendary</h4>
                            <p>Reserved for legends only</p>
                        </div>
                        <div class="item-price">
                            <span class="price">2500 ğŸ’</span>
                            <button onclick="buyItem('title', 'legendary', 2500)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="perks-tab" class="shop-tab">
                <h3>âš¡ Combat Perks (Permanent)</h3>
                <div class="shop-items">
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ’ª Double Damage</h4>
                            <p>Deal 2x damage to monsters</p>
                        </div>
                        <div class="item-price">
                            <span class="price">800 ğŸ’</span>
                            <button onclick="buyItem('perk', 'doubleDamage', 800)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>â¤ï¸ Extra Health</h4>
                            <p>Start with 150 health instead of 100</p>
                        </div>
                        <div class="item-price">
                            <span class="price">600 ğŸ’</span>
                            <button onclick="buyItem('perk', 'extraHealth', 600)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>âš¡ Fast Typing</h4>
                            <p>Monsters take longer to attack</p>
                        </div>
                        <div class="item-price">
                            <span class="price">700 ğŸ’</span>
                            <button onclick="buyItem('perk', 'fastTyping', 700)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="item-info">
                            <h4>ğŸ’ Gem Collector</h4>
                            <p>Earn 50% more gems per level</p>
                        </div>
                        <div class="item-price">
                            <span class="price">1200 ğŸ’</span>
                            <button onclick="buyItem('perk', 'gemBonus', 1200)" class="buy-btn">Buy</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const words = ["attack", "defend", "magic", "sword", "shield", "spell", "heal", "potion", "strike", "dodge", "ability", "spirit", "valor", "courage", "fury", "enchant", "bless", "curse", "poison", "fire", "ice", "thunder", "earth", "wind", "light", "darkness", "focus", "meditate", "charge", "parry", "slap", "tackle"];
        const bossWords = ["destroyer", "annihilator", "overlord", "tyrant", "colossus", "behemoth", "leviathan", "abomination", "conqueror", "devastator", "ram", "tackle", "shoot", "arrow", "sword", "chargoggagoggmanchauggagoggchaubunagungamaugg", "dragon", "wyvern", "hydra", "golem", "beast", "fiend", "demon", "devil", "angel", "archangel", "archfiend", "archdemon", "Erythrocytapheresis", "Supercalifragilisticexpialidocious"];

        let currentWord = "";
        let monsterHealth = 100;
        let playerHealth = 100;
        let currentLevel = 1;
        let isBossFight = false;
        let currentUser = "";
        let cheatMode = false;
        let cheatInterval = null;
        let gems = 0;
        let shopVisible = false;
        let playerTitle = "";
        let playerPerks = {
            doubleDamage: false,
            extraHealth: false,
            fastTyping: false,
            gemBonus: false
        };

        const monsterHealthSpan = document.getElementById("monster-health");
        const playerHealthSpan = document.getElementById("player-health");
        const currentWordDisplay = document.getElementById("current-word");
        const typingInput = document.getElementById("typing-input");
        const messageDisplay = document.getElementById("message");
        const currentLevelDisplay = document.getElementById("current-level");
        const monsterNameDisplay = document.getElementById("monster-name");
        const cheatIndicator = document.getElementById("cheat-indicator");

        function checkAuth() {
            currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'signup.html';
                return false;
            }

            document.getElementById('username').textContent = currentUser;
            loadUserStats();
            return true;
        }

        function loadUserStats() {
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            const userData = users[currentUser] || {maxLevel: 0, gamesPlayed: 0, gems: 0, title: '', perks: {}};

            gems = userData.gems || 0;
            playerTitle = userData.title || '';
            playerPerks = userData.perks || {doubleDamage: false, extraHealth: false, fastTyping: false, gemBonus: false};

            document.getElementById('best-level').textContent = userData.maxLevel;
            document.getElementById('games-played').textContent = userData.gamesPlayed;
            document.getElementById('gems-count').textContent = gems;
            document.getElementById('shop-gems').textContent = gems;
            
            // Update title display
            const titleElement = document.getElementById('player-title');
            if (playerTitle) {
                const titleText = getTitleText(playerTitle);
                titleElement.textContent = titleText + ' ';
                titleElement.style.color = getTitleColor(playerTitle);
            } else {
                titleElement.textContent = 'Welcome, ';
            }
            
            updateShopButtons();
        }

        function updateUserStats(level) {
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (users[currentUser]) {
                users[currentUser].maxLevel = Math.max(users[currentUser].maxLevel || 0, level);
                users[currentUser].gamesPlayed = (users[currentUser].gamesPlayed || 0) + 1;
                users[currentUser].gems = gems;
                users[currentUser].title = playerTitle;
                users[currentUser].perks = playerPerks;
                localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                loadUserStats();
            }
        }

        function saveUserData() {
            const users = JSON.parse(localStorage.getItem('typingBattleUsers') || '{}');
            if (users[currentUser]) {
                users[currentUser].gems = gems;
                users[currentUser].title = playerTitle;
                users[currentUser].perks = playerPerks;
                localStorage.setItem('typingBattleUsers', JSON.stringify(users));
                loadUserStats();
            }
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'signup.html';
        }

        function toggleCheatMode() {
            cheatMode = !cheatMode;
            cheatIndicator.style.display = cheatMode ? 'block' : 'none';

            if (cheatMode) {
                cheatIndicator.style.color = '#ff6b6b';
                cheatIndicator.style.fontSize = '1.2em';
                cheatIndicator.style.fontWeight = 'bold';
                cheatIndicator.style.animation = 'textGlow 1s ease-in-out infinite alternate';
                cheatIndicator.style.marginTop = '10px';
                
                // Immediately start typing the current word if game is active
                if (currentWord && !typingInput.disabled) {
                    setTimeout(autoType, 100);
                }
            } else {
                if (cheatInterval) {
                    clearInterval(cheatInterval);
                    cheatInterval = null;
                }
            }
        }

        function autoType() {
            if (!cheatMode || typingInput.disabled || !currentWord) return;

            // Clear any existing interval
            if (cheatInterval) {
                clearInterval(cheatInterval);
            }

            const word = currentWord;
            let index = 0;
            typingInput.value = ""; // Clear input before starting

            cheatInterval = setInterval(() => {
                if (!cheatMode || typingInput.disabled || index >= word.length) {
                    if (index >= word.length && cheatMode && !typingInput.disabled) {
                        // Simulate Enter key press after a short delay
                        setTimeout(() => {
                            if (cheatMode && !typingInput.disabled) {
                                const enterEvent = new KeyboardEvent('keyup', {key: 'Enter'});
                                typingInput.dispatchEvent(enterEvent);
                            }
                        }, 100);
                    }
                    clearInterval(cheatInterval);
                    cheatInterval = null;
                    return;
                }

                typingInput.value = word.substring(0, index + 1);
                index++;
            }, 30); // Faster typing - 30ms per character
        }

        function startGame() {
            playerHealth = playerPerks.extraHealth ? 150 : 100;
            currentLevel = 1;
            isBossFight = false;
            typingInput.disabled = false;
            monsterNameDisplay.classList.remove("boss");
            document.querySelector('#monster-area .character').classList.remove("boss");
            startLevel();
            updateHealthDisplays();
            typingInput.value = "";
            messageDisplay.textContent = "";
            typingInput.focus();
        }

        function startLevel() {
            currentLevelDisplay.textContent = currentLevel;
            const monsterDiv = document.querySelector('#monster-area .character');

            if (currentLevel % 5 === 0) {
                isBossFight = true;
                monsterHealth = 250;
                monsterNameDisplay.textContent = "BOSS MONSTER";
                monsterNameDisplay.classList.add("boss");
                monsterDiv.classList.add("boss");
            } else {
                isBossFight = false;
                monsterHealth = 100;
                monsterNameDisplay.textContent = "Monster";
                monsterNameDisplay.classList.remove("boss");
                monsterDiv.classList.remove("boss");
            }
            updateHealthDisplays();
            newWord();
        }

        function newWord() {
            let wordList = isBossFight ? bossWords : words;
            const randomIndex = Math.floor(Math.random() * wordList.length);
            currentWord = wordList[randomIndex];
            currentWordDisplay.textContent = currentWord;
            
            // If cheat mode is active, automatically start typing the new word
            if (cheatMode && !typingInput.disabled) {
                setTimeout(autoType, 200);
            }
        }

        function updateHealthDisplays() {
            monsterHealthSpan.textContent = monsterHealth;
            playerHealthSpan.textContent = playerHealth;
        }

        function attack(target) {
            let damage = Math.floor(Math.random() * 10) + 5;

            if (target === "monster") {
                if (isBossFight) {
                    damage = Math.floor(Math.random() * 20) + 15;
                }
                
                // Apply double damage perk
                if (playerPerks.doubleDamage) {
                    damage *= 2;
                }
                
                monsterHealth -= damage;
                if (monsterHealth <= 0) {
                    monsterHealth = 0;
                    
                    // Award gems for defeating monster
                    let gemsEarned = 100;
                    if (isBossFight) {
                        gemsEarned = 250; // Bonus for boss
                    }
                    if (playerPerks.gemBonus) {
                        gemsEarned = Math.floor(gemsEarned * 1.5);
                    }
                    
                    gems += gemsEarned;
                    document.getElementById('gems-count').textContent = gems;
                    document.getElementById('shop-gems').textContent = gems;
                    
                    if (isBossFight) {
                        messageDisplay.textContent = `You defeated the BOSS! +${gemsEarned} gems!`;
                    } else {
                        messageDisplay.textContent = `You defeated the monster! +${gemsEarned} gems!`;
                    }
                    messageDisplay.classList.add("correct");
                    messageDisplay.classList.remove("incorrect");
                    levelUp();
                } else {
                    messageDisplay.textContent = `You dealt ${damage} damage to the ${monsterNameDisplay.textContent}!`;
                    messageDisplay.classList.add("correct");
                    messageDisplay.classList.remove("incorrect");
                }
            } else if (target === "player") {
                let monsterDamage = Math.floor(Math.random() * 12) + 8;

                if (isBossFight) {
                    monsterDamage = Math.floor(Math.random() * 25) + 20;
                }

                // Fast typing perk reduces monster damage
                if (playerPerks.fastTyping) {
                    monsterDamage = Math.floor(monsterDamage * 0.7);
                }

                playerHealth -= monsterDamage;
                if (playerHealth <= 0) {
                    playerHealth = 0;
                    endGame("The monster defeated you!");
                } else {
                    messageDisplay.textContent = `The ${monsterNameDisplay.textContent} dealt ${monsterDamage} damage to you!`;
                    messageDisplay.classList.add("incorrect");
                    messageDisplay.classList.remove("correct");
                }
            }
            updateHealthDisplays();
        }

        function levelUp() {
            currentLevel++;
            setTimeout(() => {
                startLevel();
            }, 1500);
        }

        function endGame(result) {
            currentWordDisplay.textContent = result;
            typingInput.disabled = true;
            messageDisplay.textContent = "Game Over! Click 'New Game' to play again.";
            messageDisplay.classList.add("game-over");
            updateUserStats(currentLevel - 1);
        }

        // Global keyboard listener for cheat activation
        document.addEventListener("keydown", (event) => {
            if (event.ctrlKey && event.altKey && event.key === 'c') {
                event.preventDefault();
                toggleCheatMode();
            }
        });

        typingInput.addEventListener("keyup", (event) => {
            if (typingInput.disabled) return;

            if (event.key === "Enter") {
                if (typingInput.value.toLowerCase() === currentWord) {
                    attack("monster");
                    if (monsterHealth > 0) {
                        newWord();
                    }
                } else {
                    messageDisplay.textContent = "Incorrect word! Monster attacks!";
                    messageDisplay.classList.add("incorrect");
                    messageDisplay.classList.remove("correct");
                    attack("player");
                    newWord();
                }
                typingInput.value = "";
            }
        });

        // Shop Functions
        function toggleShop() {
            shopVisible = !shopVisible;
            document.getElementById('shop-overlay').style.display = shopVisible ? 'flex' : 'none';
            if (shopVisible) {
                updateShopButtons();
            }
        }

        function showTab(tabName) {
            document.querySelectorAll('.shop-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
        }

        function buyItem(type, item, price) {
            if (gems < price) {
                alert('Not enough gems! ğŸ’');
                return;
            }

            if (type === 'title') {
                playerTitle = item;
                gems -= price;
                alert('Title purchased! âœ¨');
            } else if (type === 'perk') {
                if (playerPerks[item]) {
                    alert('You already own this perk! âš¡');
                    return;
                }
                playerPerks[item] = true;
                gems -= price;
                alert('Perk purchased! Your power grows! ğŸ’ª');
            }

            saveUserData();
            updateShopButtons();
        }

        function updateShopButtons() {
            // Update gems display
            document.getElementById('gems-count').textContent = gems;
            document.getElementById('shop-gems').textContent = gems;

            // Update buy buttons
            document.querySelectorAll('.buy-btn').forEach(btn => {
                const onclick = btn.getAttribute('onclick');
                const match = onclick.match(/buyItem\('(\w+)', '(\w+)', (\d+)\)/);
                if (match) {
                    const [, type, item, price] = match;
                    
                    if (type === 'title' && playerTitle === item) {
                        btn.textContent = 'Owned';
                        btn.disabled = true;
                        btn.style.opacity = '0.5';
                    } else if (type === 'perk' && playerPerks[item]) {
                        btn.textContent = 'Owned';
                        btn.disabled = true;
                        btn.style.opacity = '0.5';
                    } else if (gems < parseInt(price)) {
                        btn.disabled = true;
                        btn.style.opacity = '0.5';
                    } else {
                        btn.textContent = 'Buy';
                        btn.disabled = false;
                        btn.style.opacity = '1';
                    }
                }
            });
        }

        function getTitleText(title) {
            const titles = {
                'swordmaster': 'ğŸ—¡ï¸ Sword Master',
                'champion': 'ğŸ† Champion',
                'legendary': 'ğŸ‘‘ Legendary'
            };
            return titles[title] || '';
        }

        function getTitleColor(title) {
            const colors = {
                'swordmaster': '#74b9ff',
                'champion': '#fdcb6e',
                'legendary': '#e17055'
            };
            return colors[title] || '#333';
        }

        // Initialize the game
        if (checkAuth()) {
            startGame();
        }
    </script>
</body>

</html>
